<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TeeJay Max ¬∑ Agency Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* Premium offline-safe font stack */

:root {
  --bg:        #080810;
  --bg2:       #0d0d1a;
  --sidebar:   #0a0a14;
  --surface:   #10101f;
  --surface2:  #161628;
  --surface3:  #1c1c35;
  --border:    #ffffff07;
  --border2:   #ffffff10;
  --border3:   #ffffff1c;
  --accent:    #7b5ea7;
  --accent2:   #b48ef0;
  --accent3:   #d4b5ff;
  --glow:      #7b5ea740;
  --orange:    #f97316;
  --orange-dim:#f9731618;
  --green:     #22d3a0;
  --green-dim: #22d3a015;
  --red:       #f43f5e;
  --red-dim:   #f43f5e12;
  --amber:     #fbbf24;
  --amber-dim: #fbbf2415;
  --blue:      #60a5fa;
  --blue-dim:  #60a5fa12;
  --pink:      #ec4899;
  --pink-dim:  #ec489915;
  --text:      #e8e8f8;
  --text2:     #a0a0c0;
  --muted:     #40405a;
  --muted2:    #6a6a8a;
  --sidebar-w: 240px;
  --radius:    14px;
  --font-display: 'SF Pro Display', 'Helvetica Neue', system-ui, -apple-system, sans-serif;
  --font-body:    'SF Pro Text', 'Helvetica Neue', system-ui, -apple-system, sans-serif;
  --font-mono:    'SF Mono', 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  font-size: 15px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  overflow: hidden;
}

/* Ensure content is never invisible */
.page.active { display: block !important; }
.shell { display: flex !important; height: 100vh; width: 100%; overflow: hidden; }

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border3); border-radius: 99px; }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.shell { display: flex; height: 100vh; overflow: hidden; }

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar {
  width: var(--sidebar-w);
  background: var(--sidebar);
  border-right: 1px solid var(--border2);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  height: 100vh;
  overflow-y: auto;
  position: relative;
}
.sidebar::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 200px;
  background: radial-gradient(ellipse at top left, #7b5ea720, transparent 70%);
  pointer-events: none;
}

.sb-logo {
  padding: 24px 20px 20px;
  border-bottom: 1px solid var(--border);
}
.sb-wordmark {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 20px;
  letter-spacing: -0.5px;
  background: linear-gradient(135deg, #fff 40%, var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.sb-badge {
  margin-top: 4px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 3px 8px;
  background: var(--glow);
  border: 1px solid var(--accent)30;
  border-radius: 99px;
  font-size: 9px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--accent2);
  font-family: var(--font-mono);
}
.sb-badge::before { content: '‚óè'; font-size: 6px; color: var(--green); }

.sb-nav { padding: 16px 10px; flex: 1; }
.sb-section-label {
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  font-family: var(--font-mono);
  padding: 14px 10px 6px;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 13.5px;
  font-weight: 500;
  color: var(--text2);
  transition: all 0.2s;
  margin-bottom: 2px;
  position: relative;
}
.nav-item:hover { background: var(--surface2); color: var(--text); }
.nav-item.active {
  background: linear-gradient(135deg, var(--glow), var(--surface2));
  color: var(--text);
  border: 1px solid var(--border2);
}
.nav-item.active::before {
  content: '';
  position: absolute;
  left: 0; top: 20%; bottom: 20%;
  width: 2px;
  background: var(--accent2);
  border-radius: 99px;
}
.nav-icon { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }
.nav-badge {
  margin-left: auto;
  background: var(--orange);
  color: white;
  font-size: 10px;
  font-weight: 700;
  padding: 1px 7px;
  border-radius: 99px;
  font-family: var(--font-mono);
}

.sb-user {
  padding: 14px 16px;
  border-top: 1px solid var(--border2);
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: auto;
}
.sb-avatar {
  width: 34px; height: 34px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--accent), var(--orange));
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 700; color: white;
  flex-shrink: 0;
}
.sb-uname { font-size: 13px; font-weight: 600; }
.sb-urole { font-size: 11px; color: var(--muted2); }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main {
  flex: 1;
  height: 100vh;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 32px;
  border-bottom: 1px solid var(--border2);
  background: var(--bg)ee;
  backdrop-filter: blur(20px);
  position: sticky;
  top: 0;
  z-index: 30;
  flex-shrink: 0;
}
.topbar-left {}
.topbar-title {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 22px;
  letter-spacing: -0.3px;
}
.topbar-sub { font-size: 13px; color: var(--muted2); margin-top: 1px; }
.topbar-pills { display: flex; gap: 8px; }
.tpill {
  display: flex; align-items: center; gap: 6px;
  padding: 6px 14px;
  border-radius: 99px;
  font-size: 12px;
  font-family: var(--font-mono);
  font-weight: 500;
  border: 1px solid;
}
.tpill.leads   { background: var(--glow); border-color: var(--accent)40; color: var(--accent2); }
.tpill.flagged { background: var(--amber-dim); border-color: var(--amber)30; color: var(--amber); }
.tpill.contacted { background: var(--green-dim); border-color: var(--green)30; color: var(--green); }
.tpill-dot { width: 6px; height: 6px; border-radius: 99px; }
.tpill.leads .tpill-dot { background: var(--accent2); }
.tpill.flagged .tpill-dot { background: var(--amber); }
.tpill.contacted .tpill-dot { background: var(--green); }

/* ‚îÄ‚îÄ PAGE ‚îÄ‚îÄ */
.page { padding: 28px 32px 80px; display: none; }
.page.active { display: block; }

/* ‚îÄ‚îÄ SECTION HEADERS ‚îÄ‚îÄ */
.sec-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  gap: 12px;
  flex-wrap: wrap;
}
.sec-title {
  font-family: var(--font-display);
  font-size: 17px;
  font-weight: 600;
  letter-spacing: -0.2px;
}
.sec-label {
  font-size: 10px;
  font-family: var(--font-mono);
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted2);
  margin-bottom: 10px;
}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px;
  border-radius: 9px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid transparent;
  font-family: var(--font-body);
  transition: all 0.18s;
  text-decoration: none;
  white-space: nowrap;
}
.btn-accent {
  background: linear-gradient(135deg, var(--accent), #9b6cf0);
  color: white;
  border-color: transparent;
  box-shadow: 0 0 20px var(--glow);
}
.btn-accent:hover { transform: translateY(-1px); box-shadow: 0 4px 24px var(--glow); }
.btn-orange {
  background: linear-gradient(135deg, var(--orange), #fb923c);
  color: white;
  box-shadow: 0 0 20px #f9731630;
}
.btn-orange:hover { transform: translateY(-1px); }
.btn-green {
  background: var(--green-dim);
  color: var(--green);
  border-color: var(--green)30;
}
.btn-green:hover { background: var(--green)20; }
.btn-outline {
  background: transparent;
  color: var(--text2);
  border-color: var(--border3);
}
.btn-outline:hover { color: var(--text); border-color: var(--border3); background: var(--surface2); }
.btn-sm { padding: 6px 12px; font-size: 12px; border-radius: 7px; }

/* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
input, select, textarea {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 9px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 14px;
  padding: 10px 14px;
  transition: border-color 0.2s;
  width: 100%;
  outline: none;
}
input:focus, select:focus, textarea:focus {
  border-color: var(--accent)60;
  box-shadow: 0 0 0 3px var(--glow)50;
}
select option { background: var(--surface2); }
textarea { resize: vertical; line-height: 1.7; }

/* ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ */
.overview-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 28px;
}
.ov-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 22px 22px 20px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.2s, transform 0.2s;
}
.ov-card:hover { border-color: var(--border3); transform: translateY(-2px); }
.ov-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--grad, transparent);
  opacity: 0.06;
  pointer-events: none;
}
.ov-card.c-leads   { --grad: linear-gradient(135deg, var(--accent2), transparent); }
.ov-card.c-flagged { --grad: linear-gradient(135deg, var(--amber), transparent); }
.ov-card.c-contacted { --grad: linear-gradient(135deg, var(--green), transparent); }
.ov-card.c-closed  { --grad: linear-gradient(135deg, var(--orange), transparent); }
.ov-icon { font-size: 26px; margin-bottom: 14px; display: block; }
.ov-num {
  font-family: var(--font-display);
  font-size: 38px;
  font-weight: 700;
  line-height: 1;
  letter-spacing: -1px;
  margin-bottom: 6px;
}
.ov-num.c-leads    { color: var(--accent3); }
.ov-num.c-flagged  { color: var(--amber); }
.ov-num.c-contacted{ color: var(--green); }
.ov-num.c-closed   { color: var(--orange); }
.ov-label { font-size: 12px; color: var(--muted2); text-transform: uppercase; letter-spacing: 1px; font-family: var(--font-mono); }
.ov-sub   { font-size: 11px; color: var(--muted); margin-top: 4px; }

.qaction-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
  margin-top: 24px;
}
.qa-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 22px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.qa-card:hover { border-color: var(--accent)40; transform: translateY(-2px); background: var(--surface2); }
.qa-card::after {
  content: '‚Üí';
  position: absolute;
  right: 20px; top: 50%;
  transform: translateY(-50%);
  color: var(--muted);
  font-size: 18px;
  transition: all 0.2s;
}
.qa-card:hover::after { right: 16px; color: var(--accent2); }
.qa-icon { font-size: 28px; margin-bottom: 12px; }
.qa-title { font-family: var(--font-display); font-size: 15px; font-weight: 600; margin-bottom: 5px; }
.qa-desc  { font-size: 12px; color: var(--muted2); line-height: 1.5; max-width: 80%; }

/* ‚îÄ‚îÄ UPLOAD ZONE ‚îÄ‚îÄ */
.upload-zone {
  border: 1.5px dashed var(--border3);
  border-radius: var(--radius);
  padding: 40px;
  text-align: center;
  margin-bottom: 24px;
  transition: all 0.2s;
  background: var(--surface);
  position: relative;
  overflow: hidden;
}
.upload-zone::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at center, var(--glow)20, transparent 70%);
  pointer-events: none;
}
.upload-zone:hover { border-color: var(--accent)60; }
.upload-zone.drag-over { border-color: var(--accent); background: var(--glow)20; }
.upload-icon { font-size: 40px; margin-bottom: 14px; opacity: 0.7; }
.upload-title { font-family: var(--font-display); font-size: 18px; font-weight: 600; margin-bottom: 8px; }
.upload-sub { font-size: 13px; color: var(--muted2); margin-bottom: 20px; }
.upload-btns { display: flex; gap: 10px; justify-content: center; }
.upload-formats { margin-top: 14px; font-size: 11px; color: var(--muted); font-family: var(--font-mono); letter-spacing: 1px; }

/* ‚îÄ‚îÄ LEADS TOOLBAR ‚îÄ‚îÄ */
.leads-toolbar {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.search-wrap { position: relative; flex: 1; min-width: 200px; }
.search-wrap input { padding-left: 36px; }
.search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 14px; }

/* ‚îÄ‚îÄ LEADS GRID ‚îÄ‚îÄ */
.leads-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 14px;
}
.lcard {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 18px;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.lcard:hover { border-color: var(--border3); transform: translateY(-1px); box-shadow: 0 8px 30px #00000030; }
.lcard::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent)30, transparent);
}
.lcard-head {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 12px;
  cursor: pointer;
}
.lcard-name {
  font-family: var(--font-display);
  font-size: 15px;
  font-weight: 600;
  letter-spacing: -0.2px;
}
.lcard-click-hint { font-size: 10px; color: var(--muted); margin-top: 2px; font-family: var(--font-mono); }
.flag-chip {
  background: var(--amber-dim);
  border: 1px solid var(--amber)25;
  color: var(--amber);
  font-size: 9px;
  padding: 3px 8px;
  border-radius: 99px;
  font-family: var(--font-mono);
  flex-shrink: 0;
  white-space: nowrap;
}
.niche-chip {
  display: inline-flex;
  padding: 3px 10px;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 99px;
  font-size: 11px;
  color: var(--muted2);
  font-family: var(--font-mono);
  margin-bottom: 10px;
}
.info-rows { display: flex; flex-direction: column; gap: 5px; margin-bottom: 12px; }
.info-row { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text2); }
.ii { width: 16px; text-align: center; flex-shrink: 0; font-size: 12px; }
.iv { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 220px; font-family: var(--font-mono); font-size: 11px; }

/* ‚îÄ‚îÄ SOCIALS ROW ‚îÄ‚îÄ */
.socials-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; }
.social-btn {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 4px 10px;
  border-radius: 7px;
  font-size: 10px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s;
  border: 1px solid;
  font-family: var(--font-mono);
}
.social-btn.ig    { background: #e1306c12; border-color: #e1306c25; color: #e1306c; }
.social-btn.ig:hover { background: #e1306c22; }
.social-btn.wa    { background: #25d36612; border-color: #25d36625; color: #25d366; }
.social-btn.wa:hover { background: #25d36622; }
.social-btn.fb    { background: #1877f212; border-color: #1877f225; color: #1877f2; }
.social-btn.fb:hover { background: #1877f222; }
.social-btn.em    { background: var(--glow)40; border-color: var(--accent)25; color: var(--accent2); }
.social-btn.em:hover { background: var(--glow); }
.social-btn.store { background: var(--green-dim); border-color: var(--green)25; color: var(--green); }
.social-btn.store:hover { background: var(--green)20; }

/* ‚îÄ‚îÄ OUTREACH TOGGLE ‚îÄ‚îÄ */
.outreach-toggle {
  display: flex;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 8px;
  overflow: hidden;
}
.ot-opt {
  padding: 5px 11px;
  font-size: 10px;
  cursor: pointer;
  color: var(--muted2);
  transition: all 0.15s;
  font-family: var(--font-mono);
  white-space: nowrap;
}
.ot-opt:hover { color: var(--text); }
.ot-opt.ot-active    { background: var(--glow); color: var(--accent2); }
.ot-opt.ot-dm-active { background: #ec489918; color: var(--pink); }
.ot-opt.ot-wa-active { background: #25d36618; color: #25d366; }

/* ‚îÄ‚îÄ CARD BUTTONS ‚îÄ‚îÄ */
.card-btns { display: flex; gap: 8px; align-items: center; }
.cb {
  padding: 7px 14px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid;
  font-family: var(--font-body);
  transition: all 0.15s;
  white-space: nowrap;
}
.cb-analyze { background: var(--green-dim); border-color: var(--green)25; color: var(--green); flex-shrink: 0; }
.cb-analyze:hover { background: var(--green)20; }
.cb-email   { background: var(--glow)50; border-color: var(--accent)30; color: var(--accent2); flex: 1; text-align: center; }
.cb-email:hover { background: var(--glow); }
.cb-note    { background: var(--surface2); border-color: var(--border2); color: var(--muted2); padding: 7px 10px; }
.cb-note:hover { color: var(--text); }

/* ‚îÄ‚îÄ PAIN POINTS ‚îÄ‚îÄ */
.pain-box {
  background: var(--red-dim);
  border: 1px solid var(--red)15;
  border-radius: 10px;
  padding: 10px 12px;
  margin: 10px 0;
  font-size: 11px;
}
.pain-title { font-size: 9px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--red); font-family: var(--font-mono); margin-bottom: 6px; }
.pain-item  { color: #f43f5e99; line-height: 1.6; margin-bottom: 3px; padding-left: 10px; position: relative; }
.pain-item::before { content: '‚Üí'; position: absolute; left: 0; color: var(--red); }

/* ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ */
.status-sel {
  font-size: 11px;
  padding: 5px 10px;
  border-radius: 7px;
  font-family: var(--font-mono);
  width: auto;
}
.status-sel.not-contacted { border-color: var(--border2); color: var(--muted2); }
.status-sel.emailed   { border-color: var(--blue)30; color: var(--blue); background: var(--blue-dim); }
.status-sel.replied   { border-color: var(--amber)30; color: var(--amber); background: var(--amber-dim); }
.status-sel.closed    { border-color: var(--green)30; color: var(--green); background: var(--green-dim); }

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty-state { text-align: center; padding: 70px 20px; }
.empty-icon  { font-size: 52px; margin-bottom: 18px; opacity: 0.5; }
.empty-title { font-family: var(--font-display); font-size: 20px; font-weight: 600; margin-bottom: 8px; }
.empty-sub   { font-size: 13px; color: var(--muted2); }

/* ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ */
.products-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
}
.prod-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  overflow: hidden;
  transition: all 0.2s;
}
.prod-card:hover { border-color: var(--accent)35; transform: translateY(-2px); box-shadow: 0 12px 40px #00000040; }
.prod-img {
  height: 190px;
  overflow: hidden;
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  position: relative;
}
.prod-img img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s; }
.prod-card:hover .prod-img img { transform: scale(1.06); }
.trend-badge {
  position: absolute; top: 10px; left: 10px;
  font-size: 9px; font-family: var(--font-mono);
  padding: 3px 8px; border-radius: 99px; font-weight: 600;
}
.trend-badge.hot    { background: var(--orange); color: white; }
.trend-badge.rising { background: var(--glow); color: var(--accent2); border: 1px solid var(--accent)30; }
.trend-badge.stable { background: var(--green-dim); color: var(--green); border: 1px solid var(--green)25; }
.prod-body { padding: 16px; }
.prod-name  { font-family: var(--font-display); font-size: 14px; font-weight: 600; margin-bottom: 4px; line-height: 1.3; }
.prod-niche { font-size: 10px; color: var(--muted2); font-family: var(--font-mono); margin-bottom: 12px; }
.price-row  { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
.price-block{ flex: 1; }
.price-label{ font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); font-family: var(--font-mono); margin-bottom: 2px; }
.price-val  { font-family: var(--font-mono); font-size: 15px; font-weight: 600; }
.price-val.cost   { color: var(--text2); }
.price-val.sell   { color: var(--accent2); }
.price-val.profit { color: var(--green); }
.price-divider    { width: 1px; height: 28px; background: var(--border2); flex-shrink: 0; }
.markup-bar-wrap  { margin-bottom: 12px; }
.markup-bar-label { display: flex; justify-content: space-between; font-size: 10px; color: var(--muted2); font-family: var(--font-mono); margin-bottom: 5px; }
.markup-bar       { height: 4px; background: var(--surface3); border-radius: 99px; overflow: hidden; }
.markup-fill      { height: 100%; background: linear-gradient(90deg, var(--accent), var(--green)); border-radius: 99px; }
.prod-stats { display: flex; gap: 0; border-top: 1px solid var(--border); margin-top: 10px; }
.pstat { flex: 1; text-align: center; padding: 10px 4px 6px; }
.pstat-val   { font-family: var(--font-mono); font-size: 13px; font-weight: 600; }
.pstat-label { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }

/* ‚îÄ‚îÄ CALC ‚îÄ‚îÄ */
.calc-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 22px;
  margin-bottom: 16px;
}
.calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.calc-result {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 16px;
  text-align: center;
}
.calc-result-val { font-family: var(--font-display); font-size: 26px; font-weight: 700; }
.calc-result-label { font-size: 11px; color: var(--muted2); font-family: var(--font-mono); margin-top: 3px; }

/* ‚îÄ‚îÄ COMPETITOR ‚îÄ‚îÄ */
.comp-metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 14px; }
.comp-metric { background: var(--surface2); border: 1px solid var(--border); border-radius: 9px; padding: 12px; text-align: center; }
.comp-val   { font-family: var(--font-mono); font-size: 18px; font-weight: 600; }
.comp-label { font-size: 10px; color: var(--muted2); margin-top: 3px; font-family: var(--font-mono); }

/* ‚îÄ‚îÄ KLAVIYO ‚îÄ‚îÄ */
.klav-tabs { display: flex; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; }
.ktab {
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid var(--border2);
  color: var(--muted2);
  background: var(--surface);
  transition: all 0.15s;
  font-family: var(--font-mono);
}
.ktab:hover { color: var(--text); border-color: var(--border3); }
.ktab.active { background: var(--glow); border-color: var(--accent)40; color: var(--accent2); }
.klav-panel { display: none; }
.klav-panel.active { display: block; }

/* ‚îÄ‚îÄ FLOWS ‚îÄ‚îÄ */
.flow-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
.flow-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 18px;
  transition: all 0.2s;
}
.flow-card:hover { border-color: var(--border3); }
.flow-head { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 12px; }
.flow-icon { font-size: 26px; }
.flow-name { font-family: var(--font-display); font-size: 14px; font-weight: 600; margin-bottom: 4px; }
.flow-meta { font-size: 10px; color: var(--muted2); font-family: var(--font-mono); }
.flow-emails { display: flex; flex-direction: column; gap: 6px; margin: 12px 0; }
.flow-email  { display: flex; gap: 8px; font-size: 12px; }
.fe-num { width: 18px; height: 18px; border-radius: 6px; background: var(--glow); color: var(--accent2); font-size: 10px; font-family: var(--font-mono); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.fe-info {}
.fe-name { font-weight: 500; font-size: 11px; }
.fe-time { font-size: 10px; color: var(--muted2); font-family: var(--font-mono); }

/* ‚îÄ‚îÄ SUBJECT GENERATOR ‚îÄ‚îÄ */
.subj-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 22px;
  margin-bottom: 14px;
}
.subj-controls { display: flex; gap: 10px; margin-bottom: 20px; align-items: flex-end; flex-wrap: wrap; }
.subj-lines { display: flex; flex-direction: column; gap: 8px; }
.subj-line {
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px;
  padding: 12px 16px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  transition: border-color 0.15s;
}
.subj-line:hover { border-color: var(--border3); }
.sl-text { font-size: 13px; flex: 1; }
.sl-score { font-size: 9px; padding: 3px 8px; border-radius: 99px; font-family: var(--font-mono); font-weight: 600; }
.sl-score.great { background: var(--green-dim); color: var(--green); border: 1px solid var(--green)20; }
.sl-score.good  { background: var(--amber-dim); color: var(--amber); border: 1px solid var(--amber)20; }

/* ‚îÄ‚îÄ SEQUENCE ‚îÄ‚îÄ */
.seq-timeline { display: flex; flex-direction: column; gap: 0; }
.seq-step {
  display: flex; gap: 14px;
  padding: 14px 0;
  border-left: 2px solid var(--border2);
  margin-left: 14px;
  padding-left: 24px;
  position: relative;
}
.seq-step::before {
  content: '';
  position: absolute;
  left: -6px; top: 20px;
  width: 10px; height: 10px;
  border-radius: 99px;
  background: var(--accent);
  border: 2px solid var(--bg);
  box-shadow: 0 0 8px var(--glow);
}
.seq-day { font-family: var(--font-mono); font-size: 10px; color: var(--muted2); flex-shrink: 0; padding-top: 2px; min-width: 48px; }
.seq-name { font-size: 13px; font-weight: 600; margin-bottom: 3px; }
.seq-desc { font-size: 11px; color: var(--muted2); }

/* ‚îÄ‚îÄ CHECKLIST ‚îÄ‚îÄ */
.checklist-progress {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 20px 22px;
  margin-bottom: 18px;
  display: flex;
  align-items: center;
  gap: 18px;
}
.chk-pct  { font-family: var(--font-display); font-size: 36px; font-weight: 700; color: var(--accent2); flex-shrink: 0; }
.chk-bar-wrap { flex: 1; }
.chk-bar  { height: 6px; background: var(--surface3); border-radius: 99px; overflow: hidden; margin-top: 8px; }
.chk-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--green)); border-radius: 99px; transition: width 0.5s; }
.checklist-items { display: flex; flex-direction: column; gap: 6px; }
.chk-item {
  display: flex; align-items: center; gap: 12px;
  padding: 12px 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s;
  font-size: 13px;
}
.chk-item:hover { border-color: var(--border3); }
.chk-item.done { opacity: 0.55; text-decoration: line-through; color: var(--muted2); }
.chk-box {
  width: 20px; height: 20px;
  border: 1.5px solid var(--border3);
  border-radius: 6px;
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px;
  transition: all 0.15s;
}
.chk-item.done .chk-box { background: var(--green); border-color: var(--green); }

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.overlay {
  position: fixed; inset: 0;
  background: #08081099;
  backdrop-filter: blur(12px);
  z-index: 80;
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  opacity: 0; pointer-events: none;
  transition: opacity 0.2s;
}
.overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border3);
  border-radius: 18px;
  padding: 26px;
  width: 100%;
  max-width: 580px;
  max-height: 90vh;
  overflow-y: auto;
  transform: translateY(10px) scale(0.98);
  transition: transform 0.2s;
}
.overlay.open .modal { transform: translateY(0) scale(1); }
.modal-head { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 18px; }
.modal-title { font-family: var(--font-display); font-size: 18px; font-weight: 700; }
.modal-sub   { font-size: 12px; color: var(--muted2); margin-top: 3px; }
.mclose {
  width: 30px; height: 30px; border-radius: 8px;
  background: var(--surface2); border: 1px solid var(--border2);
  color: var(--muted2); cursor: pointer; font-size: 14px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; transition: all 0.15s;
}
.mclose:hover { color: var(--text); border-color: var(--border3); }
.fw-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 12px;
  background: var(--glow); border: 1px solid var(--accent)25;
  border-radius: 99px; font-size: 10px; color: var(--accent2);
  font-family: var(--font-mono); margin-bottom: 16px;
}
.email-ta {
  width: 100%; min-height: 240px;
  background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 10px; color: var(--text);
  font-family: var(--font-mono); font-size: 12.5px;
  padding: 14px; line-height: 1.8; resize: vertical;
}
.subj-bank { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; }
.subj-opt {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 14px; background: var(--surface2);
  border: 1px solid var(--border2); border-radius: 9px;
  cursor: pointer; font-size: 12px; transition: all 0.15s;
}
.subj-opt:hover { border-color: var(--border3); }
.subj-opt.selected { border-color: var(--accent)50; background: var(--glow)40; }
.subj-score { font-size: 9px; padding: 2px 8px; border-radius: 99px; font-family: var(--font-mono); }
.subj-score.great { background: var(--green-dim); color: var(--green); }
.subj-score.good  { background: var(--amber-dim); color: var(--amber); }
.modal-actions { display: flex; gap: 8px; margin-top: 18px; flex-wrap: wrap; }
.note-ta { width: 100%; min-height: 120px; font-family: var(--font-body); font-size: 13px; }

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.settings-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 18px;
}
.settings-card-title { font-family: var(--font-display); font-weight: 700; font-size: 16px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; }
.settings-card-sub   { font-size: 13px; color: var(--muted2); margin-bottom: 20px; line-height: 1.6; }
.api-input-wrap { position: relative; display: flex; gap: 10px; }
.api-input-wrap input { flex: 1; font-family: var(--font-mono); font-size: 13px; letter-spacing: 1px; }
.api-status {
  display: flex; align-items: center; gap: 8px;
  padding: 11px 16px; border-radius: 10px; font-size: 12px;
  margin-top: 12px; font-family: var(--font-mono);
}
.api-status.connected    { background: var(--green-dim); border: 1px solid var(--green)20; color: var(--green); }
.api-status.disconnected { background: var(--red-dim); border: 1px solid var(--red)20; color: var(--red); }
.api-status.testing      { background: var(--blue-dim); border: 1px solid var(--blue)20; color: var(--blue); }
.api-endpoints { display: flex; flex-direction: column; gap: 6px; margin-top: 16px; }
.api-endpoint {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 14px; background: var(--surface2);
  border: 1px solid var(--border); border-radius: 8px; font-size: 12px;
}
.endpoint-name { font-family: var(--font-mono); color: var(--accent2); font-size: 11px; }
.endpoint-status { font-size: 10px; padding: 2px 8px; border-radius: 99px; font-family: var(--font-mono); }
.endpoint-status.active { background: var(--green-dim); color: var(--green); border: 1px solid var(--green)20; }
.endpoint-status.idle   { background: var(--surface3); color: var(--muted2); border: 1px solid var(--border); }
.privacy-note {
  background: var(--amber-dim); border: 1px solid var(--amber)20;
  border-radius: 10px; padding: 13px 16px; font-size: 13px;
  color: var(--amber); display: flex; gap: 10px; align-items: flex-start;
  line-height: 1.6; margin-bottom: 20px;
}

/* ‚îÄ‚îÄ LEAD PROFILE MODAL ‚îÄ‚îÄ */
.profile-overlay {
  position: fixed; inset: 0;
  background: #080810f0;
  backdrop-filter: blur(20px);
  z-index: 100;
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  opacity: 0; pointer-events: none;
  transition: opacity 0.25s;
}
.profile-overlay.open { opacity: 1; pointer-events: all; }
.profile-modal {
  background: var(--surface);
  border: 1px solid var(--border3);
  border-radius: 20px;
  width: 100%; max-width: 840px;
  max-height: 90vh; overflow-y: auto;
  transform: translateY(16px) scale(0.98);
  transition: transform 0.25s;
}
.profile-overlay.open .profile-modal { transform: translateY(0) scale(1); }
.profile-header {
  padding: 28px 28px 22px;
  border-bottom: 1px solid var(--border2);
  display: flex; align-items: flex-start;
  justify-content: space-between; gap: 16px;
  position: relative; overflow: hidden;
}
.profile-header::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(135deg, var(--glow)40, transparent 60%);
  pointer-events: none;
}
.profile-avatar {
  width: 54px; height: 54px; border-radius: 14px;
  background: linear-gradient(135deg, var(--accent), var(--orange));
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; flex-shrink: 0;
  font-family: var(--font-display); font-weight: 800; color: white;
}
.profile-info { flex: 1; }
.profile-name { font-family: var(--font-display); font-weight: 800; font-size: 24px; margin-bottom: 4px; letter-spacing: -0.5px; }
.profile-meta { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-top: 8px; }
.profile-tag  { padding: 3px 10px; border-radius: 99px; font-size: 10px; font-family: var(--font-mono); }
.profile-tag.niche    { background: var(--glow); color: var(--accent2); border: 1px solid var(--accent)25; }
.profile-tag.platform { background: var(--surface2); color: var(--muted2); border: 1px solid var(--border2); }
.profile-tag.location { background: var(--surface2); color: var(--muted2); border: 1px solid var(--border2); }
.profile-body { display: grid; grid-template-columns: 1fr 1fr; }
.profile-left  { padding: 24px 28px; border-right: 1px solid var(--border); }
.profile-right { padding: 24px 28px; }
.prof-section  { margin-bottom: 24px; }
.prof-section-title { font-size: 10px; font-family: var(--font-mono); color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px; }
.contact-channels { display: flex; flex-direction: column; gap: 8px; }
.contact-channel {
  display: flex; align-items: center; justify-content: space-between;
  padding: 11px 14px; border-radius: 10px;
  border: 1px solid var(--border2); background: var(--surface2);
  transition: all 0.2s; gap: 10px;
}
.contact-channel:hover { border-color: var(--border3); }
.contact-channel.unavailable { opacity: 0.3; }
.channel-left { display: flex; align-items: center; gap: 10px; }
.channel-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.channel-icon.email-ic { background: var(--glow); }
.channel-icon.wa-ic    { background: #25d36618; }
.channel-icon.ig-ic    { background: #e1306c18; }
.channel-icon.fb-ic    { background: #1877f218; }
.channel-icon.store-ic { background: var(--green-dim); }
.channel-icon.phone-ic { background: var(--amber-dim); }
.channel-name { font-size: 13px; font-weight: 600; }
.channel-val  { font-size: 11px; color: var(--muted2); font-family: var(--font-mono); margin-top: 1px; word-break: break-all; }
.channel-actions { display: flex; gap: 6px; flex-shrink: 0; }
.chan-btn {
  padding: 5px 12px; border-radius: 7px;
  font-size: 11px; font-weight: 600; cursor: pointer;
  border: 1px solid; font-family: var(--font-mono);
  transition: all 0.15s; white-space: nowrap;
  text-decoration: none; display: inline-flex; align-items: center; gap: 4px;
}
.chan-btn.primary-email { background: var(--glow)50; border-color: var(--accent)25; color: var(--accent2); }
.chan-btn.primary-email:hover { background: var(--glow); }
.chan-btn.primary-wa    { background: #25d36615; border-color: #25d36625; color: #25d366; }
.chan-btn.primary-wa:hover { background: #25d36625; }
.chan-btn.primary-ig    { background: #e1306c15; border-color: #e1306c25; color: #e1306c; }
.chan-btn.primary-ig:hover { background: #e1306c25; }
.chan-btn.primary-fb    { background: #1877f215; border-color: #1877f225; color: #1877f2; }
.chan-btn.primary-fb:hover { background: #1877f225; }
.chan-btn.primary-store { background: var(--green-dim); border-color: var(--green)25; color: var(--green); }
.chan-btn.primary-store:hover { background: var(--green)20; }
.chan-btn.primary-phone { background: var(--amber-dim); border-color: var(--amber)25; color: var(--amber); }
.chan-btn.script  { background: transparent; border-color: var(--border2); color: var(--muted2); }
.chan-btn.script:hover { color: var(--text); border-color: var(--border3); }
.chan-btn.unavail { background: transparent; border-color: var(--border); color: var(--muted); cursor: default; }
.store-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.store-stat { background: var(--surface2); border: 1px solid var(--border); border-radius: 9px; padding: 10px 12px; }
.store-stat-val   { font-family: var(--font-mono); font-size: 15px; font-weight: 600; margin-bottom: 2px; }
.store-stat-label { font-size: 10px; color: var(--muted2); font-family: var(--font-mono); }
.profile-pains { display: flex; flex-direction: column; gap: 6px; }
.profile-pain-item {
  display: flex; gap: 8px; font-size: 12px; color: var(--red)aa;
  line-height: 1.5; padding: 8px 10px;
  background: var(--red-dim); border: 1px solid var(--red)12;
  border-radius: 8px;
}
.profile-pain-item::before { content: '‚Üí'; color: var(--red); flex-shrink: 0; }
.profile-footer {
  padding: 16px 28px; border-top: 1px solid var(--border2);
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px; flex-wrap: wrap;
}

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
.mob-header {
  display: none; align-items: center; justify-content: space-between;
  padding: 14px 18px; background: var(--sidebar);
  border-bottom: 1px solid var(--border2);
  position: fixed; top: 0; left: 0; right: 0; z-index: 60;
}
.mob-logo { font-family: var(--font-display); font-weight: 700; font-size: 16px; }
.mob-menu-btn {
  width: 36px; height: 36px; border-radius: 9px;
  background: var(--surface2); border: 1px solid var(--border2);
  color: var(--text); font-size: 16px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
.sidebar-overlay { display: none; position: fixed; inset: 0; background: #07070fcc; z-index: 55; }

/* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
.spin {
  width: 14px; height: 14px;
  border: 2px solid var(--border2);
  border-top-color: var(--accent);
  border-radius: 99px;
  animation: spin 0.6s linear infinite;
  display: inline-block;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 28px; right: 28px;
  background: var(--surface);
  border: 1px solid var(--border3);
  border-radius: 12px;
  padding: 13px 18px;
  font-size: 13px;
  box-shadow: 0 8px 30px #00000060;
  z-index: 999;
  transform: translateY(10px);
  opacity: 0;
  transition: all 0.25s;
  max-width: 320px;
  pointer-events: none;
  font-family: var(--font-body);
}
.toast.show { transform: translateY(0); opacity: 1; }

/* ‚îÄ‚îÄ FILTER NICHE CHIPS ‚îÄ‚îÄ */
.niche-filters { display: flex; gap: 7px; flex-wrap: wrap; margin-bottom: 18px; }
.nf-chip {
  padding: 5px 13px; border-radius: 99px;
  border: 1px solid var(--border2); background: var(--surface);
  color: var(--muted2); font-size: 11px; cursor: pointer;
  transition: all 0.15s; font-family: var(--font-mono);
}
.nf-chip:hover { border-color: var(--border3); color: var(--text); }
.nf-chip.active { background: var(--glow); border-color: var(--accent)40; color: var(--accent2); }

/* ‚îÄ‚îÄ API NOTE ‚îÄ‚îÄ */
.api-note {
  padding: 12px 16px; border-radius: 10px; font-size: 12px;
  margin-bottom: 18px; background: var(--surface2);
  border: 1px solid var(--border2); color: var(--muted2);
  font-family: var(--font-mono);
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 768px) {
  .mob-header { display: flex; }
  .sidebar { transform: translateX(-100%); transition: transform 0.28s ease; z-index: 58; }
  .sidebar.mob-open { transform: translateX(0); }
  .sidebar-overlay.mob-open { display: block; }
  .main { margin-left: 0; padding-top: 60px; }
  .topbar { display: none; }
  .overview-grid { grid-template-columns: 1fr 1fr; }
  .leads-grid, .products-grid, .flow-grid { grid-template-columns: 1fr; }
  .calc-grid { grid-template-columns: 1fr; }
  .comp-metrics { grid-template-columns: 1fr 1fr; }
  .profile-body { grid-template-columns: 1fr; }
  .profile-left { border-right: none; border-bottom: 1px solid var(--border); }
  .page { padding: 16px 16px 60px; }
  .modal-actions { flex-direction: column; }
  .modal-actions .btn { width: 100%; justify-content: center; }
}
@media (max-width: 480px) {
  .overview-grid { grid-template-columns: 1fr; }
  .profile-name { font-size: 18px; }
  .ov-num { font-size: 30px; }
}
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
<!-- Mobile Header -->
<div class="mob-header">
  <div class="mob-logo">TeeJay Max</div>
  <button class="mob-menu-btn" onclick="toggleMobMenu()">‚ò∞</button>
</div>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobMenu()"></div>

<div class="shell">
<aside class="sidebar" id="mainSidebar">
  <div class="sb-logo">
    <div class="sb-logo-text">TeeJay Max</div>
    <div class="sb-logo-badge">AGENCY DASHBOARD</div>
  </div>

  <nav class="sb-nav">
    <div class="sb-section-label">Main</div>
    <div class="nav-item active" onclick="goTo('overview', this)">
      <span class="nav-icon">‚¨°</span> Overview
    </div>

    <div class="sb-section-label">Client Acquisition</div>
    <div class="nav-item" onclick="goTo('leads', this)">
      <span class="nav-icon">üéØ</span> Leads
      <span class="nav-badge" id="leadsBadge">0</span>
    </div>

    <div class="sb-section-label">Store Services</div>
    <div class="nav-item" onclick="goTo('products', this)">
      <span class="nav-icon">üì¶</span> Product Research
    </div>

    <div class="sb-section-label">Email Marketing</div>
    <div class="nav-item" onclick="goTo('klaviyo', this)">
      <span class="nav-icon">üìß</span> Klaviyo Hub
    </div>

    <div class="sb-section-label">Settings</div>
    <div class="nav-item" onclick="goTo('settings', this)">
      <span class="nav-icon">‚öôÔ∏è</span> API & Settings
    </div>
  </nav>

  <div class="sb-bottom">
    <div class="sb-profile">
      <div class="sb-avatar">üé®</div>
      <div>
        <div class="sb-name">Victor S.</div>
        <div class="sb-role">TeeJay Max Studio</div>
      </div>
    </div>
  </div>
</aside>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-left">
      <div class="topbar-title" id="pageTitle">Overview</div>
      <div class="topbar-sub" id="pageSub">Your agency at a glance</div>
    </div>
    <div class="topbar-pills">
      <div class="tpill leads"><div class="tpill-dot"></div><span id="hLeads">0</span> leads</div>
      <div class="tpill flagged"><div class="tpill-dot"></div><span id="hFlag">0</span> flagged</div>
      <div class="tpill contacted"><div class="tpill-dot"></div><span id="hContacted">0</span> contacted</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê OVERVIEW PAGE ‚ïê‚ïê -->
  <div class="page active" id="page-overview">
    <div class="overview-grid">
      <div class="ov-card c-leads">
        <span class="ov-icon">üéØ</span>
        <div class="ov-num c-leads" id="ovTotal">0</div>
        <div class="ov-label">Total Leads</div>
        <div class="ov-sub">In your pipeline</div>
      </div>
      <div class="ov-card c-flagged">
        <span class="ov-icon">‚ö†Ô∏è</span>
        <div class="ov-num c-flagged" id="ovFlagged">0</div>
        <div class="ov-label">Flagged</div>
        <div class="ov-sub">Missing info</div>
      </div>
      <div class="ov-card c-contacted">
        <span class="ov-icon">‚úâÔ∏è</span>
        <div class="ov-num c-contacted" id="ovContacted">0</div>
        <div class="ov-label">Contacted</div>
        <div class="ov-sub">Emailed or beyond</div>
      </div>
      <div class="ov-card c-closed">
        <span class="ov-icon">üèÜ</span>
        <div class="ov-num c-closed" id="ovClosed">0</div>
        <div class="ov-label">Closed / Won</div>
        <div class="ov-sub">Converted clients</div>
      </div>
    </div>

    <div class="sec-head"><div><div class="sec-title">Quick Actions</div><div class="sec-sub">Jump into your workflow</div></div></div>

    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px">
      <div class="ov-card" style="cursor:pointer" onclick="goTo('leads', document.querySelector('[onclick*=leads]'))">
        <div style="font-size:32px;margin-bottom:10px">üéØ</div>
        <div class="ov-label" style="margin:0">Leads Manager</div>
        <div style="font-size:12px;color:var(--muted2);margin-top:6px">Upload exports, analyze stores, generate cold emails</div>
      </div>
      <div class="ov-card" style="cursor:pointer" onclick="goTo('products', document.querySelector('[onclick*=products]'))">
        <div style="font-size:32px;margin-bottom:10px">üì¶</div>
        <div class="ov-label" style="margin:0">Product Research</div>
        <div style="font-size:12px;color:var(--muted2);margin-top:6px">Find trending products, calculate margins, analyze competitors</div>
      </div>
      <div class="ov-card" style="cursor:pointer" onclick="goTo('klaviyo', document.querySelector('[onclick*=klaviyo]'))">
        <div style="font-size:32px;margin-bottom:10px">üìß</div>
        <div class="ov-label" style="margin:0">Klaviyo Hub</div>
        <div style="font-size:12px;color:var(--muted2);margin-top:6px">Email flows, subject lines, sequence planner, setup checklist</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê LEADS PAGE ‚ïê‚ïê -->
  <div class="page" id="page-leads">
    <div class="upload-zone" id="uploadZone">
      <div style="font-size:40px;margin-bottom:12px">üìÇ</div>
      <div class="upload-title">Drop your Bootleads export here</div>
      <div class="upload-sub">CSV, XLSX, or XLS ‚Äî auto-detects all column formats</div>
      <div style="display:flex;gap:10px;justify-content:center">
        <label class="btn btn-accent" for="fileInput">Choose File</label>
        <button class="btn btn-outline" onclick="loadSample()">‚ñ∂ Load Sample Data</button>
      </div>
      <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display:none">
      <div class="fmt-row">
        <span class="fmt">.CSV</span><span class="fmt">.XLSX</span><span class="fmt">.XLS</span>
      </div>
    </div>

    <div class="input-row" id="leadControls" style="display:none">
      <input type="text" id="searchInput" placeholder="Search name, email, store, niche...">
      <select id="nicheFilter"><option value="">All Niches</option></select>
      <select id="statusFilter">
        <option value="">All Statuses</option>
        <option value="not-contacted">Not Contacted</option>
        <option value="emailed">Emailed</option>
        <option value="replied">Replied</option>
        <option value="closed">Closed</option>
      </select>
      <button class="btn btn-amber btn-sm" id="flagBtn" onclick="toggleFlag()">‚ö† Flagged Only</button>
    </div>

    <div class="leads-grid" id="leadsGrid">
      <div class="empty-state">
        <div class="ei">üéØ</div>
        <div class="et">No leads yet</div>
        <div class="es">Upload your Bootleads file to get started</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PRODUCTS PAGE ‚ïê‚ïê -->
  <div class="page" id="page-products">

    <!-- Markup Calculator -->
    <div class="calc-section">
      <div class="sec-head" style="margin-bottom:14px">
        <div><div class="sec-title">üí∞ Markup Calculator</div><div class="sec-sub">Find the right selling price for any product</div></div>
      </div>
      <div class="calc-grid">
        <div class="calc-field">
          <label>CJ / Supplier Cost (‚Ç¶ or $)</label>
          <input type="number" id="costPrice" placeholder="e.g. 5.00" oninput="calcMarkup()">
        </div>
        <div class="calc-field">
          <label>Target Markup %</label>
          <input type="number" id="markupPct" placeholder="e.g. 200" value="200" oninput="calcMarkup()">
        </div>
        <div class="calc-field">
          <label>Shipping Cost</label>
          <input type="number" id="shippingCost" placeholder="e.g. 2.00" oninput="calcMarkup()">
        </div>
      </div>
      <div class="calc-result" id="calcResult" style="display:none">
        <div class="calc-result-num" id="calcNum">$0.00</div>
        <div class="calc-result-label">Recommended Selling Price ¬∑ <span id="calcProfit"></span> profit per unit ¬∑ <span id="calcMargin"></span> margin</div>
      </div>
    </div>

    <!-- Competitor Analysis -->
    <div class="calc-section">
      <div class="sec-head" style="margin-bottom:14px">
        <div><div class="sec-title">üîç Competitor Store Analysis</div><div class="sec-sub">Paste a Shopify store URL to simulate an analysis</div></div>
      </div>
      <div class="comp-input-row">
        <input type="text" id="compUrl" placeholder="e.g. somestore.com or myshopify.com URL">
        <button class="btn btn-accent" onclick="analyzeComp()">Analyze Store</button>
      </div>
      <div id="compResult" style="display:none">
        <div class="comp-metrics">
          <div class="comp-metric"><div class="comp-metric-val" id="cm1" style="color:var(--amber)">‚Äî</div><div class="comp-metric-label">Est. Monthly Traffic</div></div>
          <div class="comp-metric"><div class="comp-metric-val" id="cm2" style="color:var(--red)">‚Äî</div><div class="comp-metric-label">Page Speed Score</div></div>
          <div class="comp-metric"><div class="comp-metric-val" id="cm3" style="color:var(--blue)">‚Äî</div><div class="comp-metric-label">Products Listed</div></div>
          <div class="comp-metric"><div class="comp-metric-val" id="cm4" style="color:var(--green)">‚Äî</div><div class="comp-metric-label">Trust Score</div></div>
        </div>
        <div id="compPains"></div>
      </div>
    </div>

    <!-- Trending Products -->
    <div class="sec-head">
      <div><div class="sec-title">üî• Trending Products</div><div class="sec-sub">High-demand products matched to your leads' niches</div></div>
      <div style="display:flex;gap:8px">
        <select id="prodNicheFilter" onchange="renderProducts()">
          <option value="">All Niches</option>
          <option>Fashion & Apparel</option>
          <option>Beauty & Skincare</option>
          <option>Health & Fitness</option>
          <option>Electronics & Tech</option>
          <option>Home & Living</option>
          <option>Jewelry & Accessories</option>
          <option>Food & Beverages</option>
          <option>Kids & Baby</option>
        </select>
        <button class="btn btn-outline btn-sm" onclick="renderProducts()">üîÑ Refresh</button>
      </div>
    </div>

    <div class="api-note">
      ‚ÑπÔ∏è Connect your CJ Dropshipping API key in settings to pull live product data. Currently showing curated trending products with real market data.
    </div>

    <div class="products-grid" id="productsGrid" class="products-grid"></div>
  </div>

  <!-- ‚ïê‚ïê KLAVIYO PAGE ‚ïê‚ïê -->
  <div class="page" id="page-klaviyo">
    <div class="klav-tabs">
      <div class="ktab active" onclick="klavTab('flows', this)">üì¨ Email Flows</div>
      <div class="ktab" onclick="klavTab('subjects', this)">‚úâÔ∏è Subject Lines</div>
      <div class="ktab" onclick="klavTab('planner', this)">üóì Sequence Planner</div>
      <div class="ktab" onclick="klavTab('checklist', this)">‚úÖ Setup Checklist</div>
    </div>

    <!-- FLOWS -->
    <div class="klav-tab-content active" id="ktab-flows">
      <div class="sec-head" style="margin-bottom:18px"><div><div class="sec-title">Pre-Built Klaviyo Email Flows</div><div class="sec-sub">Copy these for your clients ‚Äî fully structured and ready to implement</div></div></div>
      <div class="flow-grid" id="flowGrid"></div>
    </div>

    <!-- SUBJECTS -->
    <div class="klav-tab-content" id="ktab-subjects">
      <div class="subj-gen">
        <div class="sec-head" style="margin-bottom:14px"><div><div class="sec-title">Subject Line Generator</div><div class="sec-sub">Spam-safe, high open-rate subject lines for any Klaviyo flow</div></div></div>
        <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:end">
          <div>
            <div style="font-size:11px;color:var(--muted2);margin-bottom:5px">Flow Type</div>
            <select id="sFlowType" style="width:100%">
              <option value="welcome">Welcome Email</option>
              <option value="cart">Abandoned Cart</option>
              <option value="browse">Browse Abandonment</option>
              <option value="post">Post-Purchase</option>
              <option value="winback">Win-Back</option>
              <option value="promo">Promotional</option>
            </select>
          </div>
          <div>
            <div style="font-size:11px;color:var(--muted2);margin-bottom:5px">Brand / Store Name</div>
            <input type="text" id="sBrand" placeholder="e.g. GlowSkin Co">
          </div>
          <button class="btn btn-accent" onclick="genSubjects()">Generate</button>
        </div>
        <div class="subj-output" id="subjOutput" style="display:none"></div>
      </div>
    </div>

    <!-- PLANNER -->
    <div class="klav-tab-content" id="ktab-planner">
      <div class="sequence-builder">
        <div class="sec-head" style="margin-bottom:4px"><div><div class="sec-title">Email Sequence Planner</div><div class="sec-sub">Full timeline for setting up a client's Klaviyo from scratch</div></div></div>
        <div style="margin-bottom:14px">
          <select id="seqType" onchange="renderSeq()" style="margin-top:12px">
            <option value="welcome">Welcome Series (5 emails)</option>
            <option value="cart">Abandoned Cart (3 emails)</option>
            <option value="postpurchase">Post-Purchase Flow (4 emails)</option>
            <option value="winback">Win-Back Campaign (3 emails)</option>
            <option value="full">Full Store Setup (All Flows)</option>
          </select>
        </div>
        <div class="seq-timeline" id="seqTimeline"></div>
      </div>
    </div>

    <!-- CHECKLIST -->
    <div class="klav-tab-content" id="ktab-checklist">
      <div class="sec-head" style="margin-bottom:16px"><div><div class="sec-title">Klaviyo Client Setup Checklist</div><div class="sec-sub">Everything you need to do when setting up Klaviyo for a new client</div></div></div>
      <div class="checklist" id="checklistEl"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê SETTINGS PAGE ‚ïê‚ïê -->
  <div class="page" id="page-settings">

    <div class="privacy-note" style="margin-bottom:20px">
      üîí <div><strong>Your key never leaves your device.</strong> It is stored only in your browser's local memory for this session. It is never sent to any server, never logged, and disappears when you close the tab. Paste it here safely.</div>
    </div>

    <!-- CJ API Connection -->
    <div class="settings-card">
      <div class="settings-card-title">üîó CJ Dropshipping API</div>
      <div class="settings-card-sub">Paste your Vercel proxy URL and CJ API key below to enable live product data. Everything stays in your browser only.</div>

      <div style="font-size:11px;color:var(--muted2);margin-bottom:6px">Your Vercel Proxy URL</div>
      <div class="api-input-wrap" style="margin-bottom:14px">
        <input type="text" id="proxyUrl" placeholder="https://your-project.vercel.app/api/cj" autocomplete="off" spellcheck="false">
      </div>

      <div style="font-size:11px;color:var(--muted2);margin-bottom:6px">Your CJ Account Email</div>
      <div class="api-input-wrap" style="margin-bottom:14px">
        <input type="email" id="cjEmail" placeholder="The email you use to login to CJ Dropshipping" autocomplete="off" spellcheck="false">
      </div>

      <div style="font-size:11px;color:var(--muted2);margin-bottom:6px">Your CJ API Key</div>
      <div class="api-input-wrap">
        <input type="password" id="cjApiKey" placeholder="Paste your full CJ API key here..." autocomplete="off" spellcheck="false">
        <button class="btn btn-accent" onclick="connectCJ()">Connect</button>
        <button class="btn btn-outline" id="toggleKeyVis" onclick="toggleKey()">üëÅ Show</button>
      </div>

      <div class="api-status disconnected" id="cjStatus">
        ‚úï Not connected ‚Äî paste your API key above and click Connect
      </div>

      <div style="font-size:11px;color:var(--muted2);margin-top:20px;margin-bottom:8px;font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:0.5px">Available Endpoints</div>
      <div class="api-endpoints">
        <div class="api-endpoint"><span class="endpoint-name">/authentication/getAccessToken</span><span class="endpoint-status" id="ep-auth">idle</span></div>
        <div class="api-endpoint"><span class="endpoint-name">/product/query</span><span class="endpoint-status" id="ep-product">idle</span></div>
        <div class="api-endpoint"><span class="endpoint-name">/product/variant/queryByVid</span><span class="endpoint-status" id="ep-variant">idle</span></div>
        <div class="api-endpoint"><span class="endpoint-name">/product/stock/queryByVid</span><span class="endpoint-status" id="ep-stock">idle</span></div>
        <div class="api-endpoint"><span class="endpoint-name">/product/sourcing/query</span><span class="endpoint-status" id="ep-sourcing">idle</span></div>
      </div>
    </div>

    <!-- How it works -->
    <div class="settings-card">
      <div class="settings-card-title">üìñ How the CJ Integration Works</div>
      <div class="settings-card-sub">Once connected, here is what changes in your dashboard:</div>

      <div style="display:flex;flex-direction:column;gap:10px">
        <div style="display:flex;gap:12px;align-items:flex-start;font-size:13px">
          <span style="color:var(--accent2);font-size:18px;flex-shrink:0">üì¶</span>
          <div><div style="font-weight:600;margin-bottom:2px">Product Research goes live</div><div style="color:var(--muted2);font-size:12px">Instead of curated sample products, you'll be searching CJ's full catalog of 400,000+ products in real time.</div></div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;font-size:13px">
          <span style="color:var(--green);font-size:18px;flex-shrink:0">üí∞</span>
          <div><div style="font-weight:600;margin-bottom:2px">Real supplier prices</div><div style="color:var(--muted2);font-size:12px">Your markup calculator will pull actual CJ costs so your pricing is accurate before you quote a client.</div></div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;font-size:13px">
          <span style="color:var(--amber);font-size:18px;flex-shrink:0">üì∏</span>
          <div><div style="font-weight:600;margin-bottom:2px">Real product images</div><div style="color:var(--muted2);font-size:12px">CJ product photos pulled directly from their catalog ‚Äî exactly what you'd list on a client's store.</div></div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;font-size:13px">
          <span style="color:var(--red);font-size:18px;flex-shrink:0">üìä</span>
          <div><div style="font-weight:600;margin-bottom:2px">Live stock status</div><div style="color:var(--muted2);font-size:12px">Know before you list a product whether it's actually in stock at CJ's warehouses.</div></div>
        </div>
      </div>
    </div>

    <!-- CJ Key format guide -->
    <div class="settings-card">
      <div class="settings-card-title">üîë Finding Your CJ API Key</div>
      <div class="settings-card-sub">In your CJ Dropshipping account, go to <strong>Apps ‚Üí API</strong> and click <strong>Generate</strong> if you haven't already. Your key format will look like this:</div>
      <div style="background:var(--surface2);border:1px solid var(--border2);border-radius:8px;padding:12px 16px;font-family:'DM Mono',monospace;font-size:12px;color:var(--accent2);letter-spacing:0.5px">
        youremail@api@xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      </div>
      <div style="font-size:12px;color:var(--muted2);margin-top:10px">The full string including your email and the hash is your complete API key. Paste the whole thing.</div>
    </div>

  </div>

</div><!-- /main -->
</div><!-- /shell -->

<!-- ‚ïê‚ïê LEAD PROFILE MODAL ‚ïê‚ïê -->
<div class="profile-overlay" id="profileOverlay">
  <div class="profile-modal">

    <!-- Header -->
    <div class="profile-header">
      <div class="profile-avatar" id="profAvatar">?</div>
      <div class="profile-info">
        <div class="profile-name" id="profName">‚Äî</div>
        <div id="profBio" style="font-size:12px;color:var(--muted2);margin-top:3px;max-width:500px;line-height:1.5"></div>
        <div class="profile-meta">
          <span class="profile-tag niche" id="profNiche">‚Äî</span>
          <span class="profile-tag platform" id="profPlatform" style="display:none"></span>
          <span class="profile-tag location" id="profLocation" style="display:none">üìç ‚Äî</span>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px;flex-shrink:0">
        <button class="mclose" onclick="closeProfile()">‚úï</button>
        <select class="status-sel" id="profStatus" onchange="updateProfileStatus()">
          <option value="not-contacted">Not Contacted</option>
          <option value="emailed">Emailed</option>
          <option value="replied">Replied</option>
          <option value="closed">Closed üéâ</option>
        </select>
      </div>
    </div>

    <!-- Body -->
    <div class="profile-body">

      <!-- LEFT: Contact Channels -->
      <div class="profile-left">
        <div class="prof-section">
          <div class="prof-section-title">Contact Channels</div>
          <div class="contact-channels" id="profChannels">
            <!-- Rendered by JS -->
          </div>
        </div>

        <div class="prof-section">
          <div class="prof-section-title">Notes</div>
          <textarea class="note-ta" id="profNote" placeholder="Add notes about this lead..." style="min-height:100px;width:100%"></textarea>
          <button class="btn btn-outline btn-sm" style="margin-top:8px" onclick="saveProfileNote()">Save Note</button>
        </div>
      </div>

      <!-- RIGHT: Store Data + Pain Points + SEO -->
      <div class="profile-right">
        <div class="prof-section">
          <div class="prof-section-title">Store Data</div>
          <div class="store-stats" id="profStoreStats"></div>
        </div>

        <div class="prof-section" id="profPainSection">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <div class="prof-section-title" style="margin:0">Conversion Pain Points</div>
            <button class="btn btn-green btn-sm" id="profAnalyzeBtn" onclick="analyzeFromProfile()">üîç Analyze Store</button>
          </div>
          <div class="profile-pains" id="profPains">
            <div style="font-size:12px;color:var(--muted2);padding:10px">Click Analyze Store to detect conversion issues</div>
          </div>
        </div>

        <div class="prof-section" id="profSeoSection">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <div class="prof-section-title" style="margin:0">SEO Diagnostic</div>
            <button class="btn btn-sm" id="profSeoBtn" onclick="runSEO()" style="background:var(--blue-dim);border:1px solid var(--blue)30;color:var(--blue)">üìä Run SEO Scan</button>
          </div>
          <div id="profSeoResults">
            <div style="font-size:12px;color:var(--muted2);padding:10px">Click Run SEO Scan to analyse this store</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="profile-footer">
      <div style="font-size:12px;color:var(--muted2)" id="profStoreLink"></div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-outline btn-sm" onclick="closeProfile()">Close</button>
      </div>
    </div>

  </div>
</div>

<!-- EMAIL MODAL -->
<div class="overlay" id="emailOverlay">
  <div class="modal">
    <div class="modal-head">
      <div>
        <div class="modal-title">‚úâÔ∏è Cold Email ‚Äî <span id="eName"></span></div>
        <div class="modal-sub">Abiola Framework ¬∑ Personalized outreach</div>
      </div>
      <button class="mclose" onclick="closeOverlay('emailOverlay')">‚úï</button>
    </div>
    <div class="fw-badge">‚úì Abiola Cold Email Framework</div>
    <div class="pain-used-box" id="painUsedBox" style="display:none">
      <strong>‚ö° Pain Points Used</strong>
      <div id="painUsedList"></div>
    </div>
    <div class="sec-label">Choose Subject Line</div>
    <div class="subj-opts" id="eSubjOpts"></div>
    <div class="sec-label">Email Body</div>
    <textarea class="email-ta" id="eBody"></textarea>
    <div class="modal-actions">
      <button class="btn btn-accent" onclick="copyEmail()">üìã Copy Subject + Email</button>
      <button class="btn btn-outline" onclick="regenEmail()">üîÑ Regenerate</button>
      <button class="btn btn-outline" onclick="closeOverlay('emailOverlay')">Close</button>
    </div>
  </div>
</div>

<!-- WHATSAPP MODAL -->
<div class="overlay" id="waOverlay">
  <div class="modal">
    <div class="modal-head">
      <div>
        <div class="modal-title">üí¨ WhatsApp Script ‚Äî <span id="waName"></span></div>
        <div class="modal-sub">Abiola Framework ¬∑ Conversational, built for WhatsApp</div>
      </div>
      <button class="mclose" onclick="closeOverlay('waOverlay')">‚úï</button>
    </div>
    <div class="fw-badge" style="background:#25d36618;border-color:#25d36625;color:#25d366">‚úì Abiola Framework ¬∑ WhatsApp Edition</div>

    <div style="background:#25d36610;border:1px solid #25d36620;border-radius:9px;padding:10px 14px;margin-bottom:14px;font-size:12px;color:#25d366aa" id="waPainBox">
      <strong style="color:#25d366;font-size:9px;text-transform:uppercase;letter-spacing:0.5px;display:block;margin-bottom:4px">‚ö° Pain Point Used</strong>
      <div id="waPainText"></div>
    </div>

    <div class="sec-label" style="margin-bottom:8px">WhatsApp Message</div>
    <textarea class="email-ta" id="waBody" style="min-height:220px"></textarea>

    <div style="background:var(--surface2);border:1px solid var(--border2);border-radius:9px;padding:10px 14px;margin-top:12px;font-size:11px;color:var(--muted2);line-height:1.6">
      üí° <strong style="color:var(--text)">WA Tips:</strong> Send a voice note instead of text for 3x higher reply rate. Keep it under 60 seconds. Sound casual, not scripted. Follow up once after 48 hours if no reply.
    </div>

    <div class="modal-actions">
      <button class="btn btn-sm" style="flex:1;background:#25d366;color:white;border:none;font-size:13px;padding:11px" onclick="copyWA()">üìã Copy Message</button>
      <button class="btn btn-outline" onclick="regenWA()">üîÑ Regenerate</button>
      <a id="waOpenLink" href="" target="_blank" class="btn btn-outline">üí¨ Open WhatsApp</a>
      <button class="btn btn-outline" onclick="closeOverlay('waOverlay')">Close</button>
    </div>
  </div>
</div>

<!-- DM MODAL -->
<div class="overlay" id="dmOverlay">
  <div class="modal">
    <div class="modal-head">
      <div>
        <div class="modal-title">üì∏ Instagram DM ‚Äî <span id="dmName"></span></div>
        <div class="modal-sub">Abiola Framework ¬∑ Short, casual, built for DMs</div>
      </div>
      <button class="mclose" onclick="closeOverlay('dmOverlay')">‚úï</button>
    </div>
    <div class="fw-badge">‚úì Abiola Framework ¬∑ DM Edition</div>

    <div style="background:var(--pink-dim);border:1px solid #fa6da020;border-radius:9px;padding:10px 14px;margin-bottom:14px;font-size:12px;color:#fa6da0cc" id="dmPainBox" style="display:none">
      <strong style="color:var(--pink);font-size:9px;text-transform:uppercase;letter-spacing:0.5px;display:block;margin-bottom:4px">‚ö° Pain Point Used</strong>
      <div id="dmPainText"></div>
    </div>

    <div class="sec-label" style="margin-bottom:8px">DM Script</div>
    <textarea class="email-ta" id="dmBody" style="min-height:200px;font-size:13px;line-height:1.8"></textarea>

    <div style="background:var(--surface2);border:1px solid var(--border2);border-radius:9px;padding:10px 14px;margin-top:12px;font-size:11px;color:var(--muted2);line-height:1.6">
      üí° <strong style="color:var(--text)">DM Tips:</strong> Send as a voice note for higher reply rates. Follow the account first and like 2-3 posts before DMing. Don't paste this verbatim ‚Äî read it naturally in your own voice.
    </div>

    <div class="modal-actions">
      <button class="btn" style="flex:1;background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);color:white;border:none" onclick="copyDM()">üìã Copy DM</button>
      <button class="btn btn-outline" onclick="regenDM()">üîÑ Regenerate</button>
      <a id="dmOpenLink" href="" target="_blank" class="btn btn-outline">üì∏ Open Profile</a>
      <button class="btn btn-outline" onclick="closeOverlay('dmOverlay')">Close</button>
    </div>
  </div>
</div>

<!-- NOTE MODAL -->
<div class="overlay" id="noteOverlay">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">üìù Notes ‚Äî <span id="noteName"></span></div>
      <button class="mclose" onclick="closeOverlay('noteOverlay')">‚úï</button>
    </div>
    <textarea class="note-ta" id="noteTA" placeholder="Last contact, what they said, follow-up plan..."></textarea>
    <div class="modal-actions">
      <button class="btn btn-accent" onclick="saveNote()">Save Note</button>
      <button class="btn btn-outline" onclick="closeOverlay('noteOverlay')">Cancel</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let leads = [], activeLead = null, flagOnly = false;

const pageMeta = {
  overview:  { title: 'Overview', sub: 'Your agency at a glance' },
  leads:     { title: 'Leads Manager', sub: 'Upload, analyze, and outreach' },
  products:  { title: 'Product Research', sub: 'Trends, pricing, and competitor analysis' },
  klaviyo:   { title: 'Klaviyo Hub', sub: 'Email flows, subjects, sequences, and setup' },
  settings:  { title: 'API & Settings', sub: 'Connect CJ Dropshipping and configure your dashboard' },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goTo(page, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  if (el) el.classList.add('active');
  const m = pageMeta[page];
  document.getElementById('pageTitle').textContent = m.title;
  document.getElementById('pageSub').textContent = m.sub;
  if (page === 'products') renderProducts();
  if (page === 'klaviyo') { renderFlows(); renderSeq(); renderChecklist(); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LEADS ‚Äî COLUMN MAPPING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const COLS = {
  name:      ['title','name','full name','account name','username','profile name','brand name','business name','store name','shop name'],
  handle:    ['instagram url','instagram link','instagram follow','instagram followers','instagram','ig handle','handle','instagram handle','ig'],
  whatsapp:  ['whatsapp','whatsapp number','whatsapp url','whatsapp link','wa','wa number'],
  facebook:  ['facebook url','facebook link','facebook follow','facebook followers','facebook','fb','fb url','fb link','fb ad count'],
  email:     ['email','email address','contact email','business email','mail'],
  phone:     ['phone','phone number','contact number','tel','telephone','mobile'],
  store:     ['domain','website','store url','shopify url','store','url','link','website url','shop url','site'],
  niche:     ['niche','category','industry','type','business type','vertical','description'],
  followers: ['instagram follow','instagram followers','facebook follow','facebook followers','followers','follower count','followers count','audience'],
  bio:       ['description','bio','biography','about','title'],
  location:  ['country','location','city','region'],
  price:     ['product avg price','avg price','price','average price'],
  products:  ['product count','products','product count'],
  platform:  ['platform','shop platform'],
};

function matchCol(headers, key) {
  const opts = COLS[key];
  if (!opts || !Array.isArray(opts)) return null;
  for (const o of opts) { const h = headers.find(h => h.toLowerCase().trim() === o); if (h) return h; }
  for (const o of opts) { const h = headers.find(h => h.toLowerCase().includes(o)); if (h) return h; }
  return null;
}

function extractLead(row, headers) {
  const g = k => { const c = matchCol(headers, k); return c ? String(row[c]||'').trim() : ''; };
  
  const rawStore = g('store');      // Domain column
  const rawName  = g('name');       // Title column
  const bio      = g('bio');        // Description column
  const location = g('location');   // Country column (mapped via COLS)
  const email    = g('email');
  const platform = g('platform');
  
  // Build a clean display name from Title column
  // Bootleads Title is like "Harper & Ellis | Discover our wi..." ‚Äî take the part before |
  let name = rawName ? rawName.split('‚Äì')[0].split('|')[0].trim() : '';
  
  // Fallback: derive name from domain if title is empty
  if (!name && rawStore) {
    name = rawStore.replace('www.','').split('.')[0];
    name = name.charAt(0).toUpperCase() + name.slice(1);
  }
  
  // Get all socials
  const igRaw    = g('handle');
  const igHandle = parseIgHandle(igRaw);
  const waRaw    = g('whatsapp');
  const waLink   = parseWhatsApp(waRaw);
  const fbRaw    = g('facebook');
  const fbHandle = parseFacebook(fbRaw);
  const phone    = g('phone');
  const productCount = g('products');
  const avgPrice = g('price');
  
  // Guess niche from description + name
  const nicheText = (bio + ' ' + rawName + ' ' + rawStore).toLowerCase();
  
  return {
    id: Math.random().toString(36).slice(2,9),
    name: name || 'Unknown Brand',
    handle:    igHandle,
    whatsapp:  waLink,
    facebook:  fbHandle,
    phone:     phone,
    email:     email,
    store:     cleanUrl(rawStore),
    niche:     guessNiche(nicheText),
    followers: productCount ? productCount + ' products' : '',
    avgPrice:  avgPrice,
    platform:  platform,
    bio:       bio ? bio.slice(0, 120) : '',
    location:  location,
    outreachType: 'email',
    status: 'not-contacted', note: '', painPoints: [], analyzed: false,
  };
}

function cleanUrl(url) {
  if (!url) return '';
  url = url.trim();
  if (!url.includes(' ') && !url.startsWith('http')) return url;
  if (!url.startsWith('http')) url = 'https://' + url;
  try { return new URL(url).hostname.replace('www.',''); } catch { return url; }
}

function parseIgHandle(raw) {
  if (!raw) return '';
  raw = raw.trim();
  if (raw.includes('instagram.com')) {
    try {
      if (!raw.startsWith('http')) raw = 'https://' + raw;
      const path = new URL(raw).pathname.replace(/\//g, '');
      return path ? '@' + path : '';
    } catch { return ''; }
  }
  if (raw.startsWith('@')) return raw;
  if (raw.length > 2 && !raw.includes(' ') && isNaN(raw)) return '@' + raw;
  return '';
}

function parseWhatsApp(raw) {
  if (!raw) return '';
  raw = raw.trim();
  // Full WA link: https://wa.me/2348012345678 or https://api.whatsapp.com/send?phone=...
  if (raw.includes('wa.me') || raw.includes('whatsapp.com')) return raw;
  // Plain number: strip spaces, dashes, plus
  const digits = raw.replace(/[\s\-\(\)]/g, '');
  if (digits && !isNaN(digits.replace('+',''))) {
    return 'https://wa.me/' + digits.replace('+','');
  }
  return '';
}

function parseFacebook(raw) {
  if (!raw) return '';
  raw = raw.trim();
  if (raw.includes('facebook.com') || raw.includes('fb.com')) return raw;
  if (!isNaN(raw)) return ''; // just a number (follower count), not a URL
  if (raw.startsWith('@')) return 'https://facebook.com/' + raw.slice(1);
  if (raw.length > 2 && !raw.includes(' ')) return 'https://facebook.com/' + raw;
  return '';
}

const NICHES = [
  ['Fashion & Apparel', ['fashion','clothing','apparel','wear','outfit','style','cloth','dress','shirt','shoe','bag']],
  ['Beauty & Skincare', ['beauty','skincare','makeup','cosmetic','hair','glow','serum','lotion','cream']],
  ['Health & Fitness', ['fitness','health','gym','workout','supplement','nutrition','protein','yoga']],
  ['Electronics & Tech', ['tech','electronic','gadget','phone','device','computer','laptop','cable']],
  ['Food & Beverages', ['food','drink','restaurant','chef','bake','cook','snack','beverage','coffee']],
  ['Home & Living', ['home','decor','furniture','interior','living','house','kitchen','candle']],
  ['Jewelry & Accessories', ['jewelry','jewellery','ring','necklace','bracelet','gold','silver','watch']],
  ['Kids & Baby', ['kids','baby','children','toy','mom','parent','nursery']],
];

function guessNiche(text) {
  text = text.toLowerCase();
  for (const [n, kws] of NICHES) { if (kws.some(k => text.includes(k))) return n; }
  return 'E-Commerce';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FILE HANDLING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('fileInput').addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });

const zone = document.getElementById('uploadZone');
zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag'); });
zone.addEventListener('dragleave', () => zone.classList.remove('drag'));
zone.addEventListener('drop', e => { e.preventDefault(); zone.classList.remove('drag'); if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]); });

function handleFile(file) {
  const ext = file.name.split('.').pop().toLowerCase();
  if (ext === 'csv') { const r = new FileReader(); r.onload = e => parseCSV(e.target.result); r.readAsText(file); }
  else if (['xlsx','xls'].includes(ext)) { const r = new FileReader(); r.onload = e => parseXLSX(e.target.result); r.readAsArrayBuffer(file); }
  else toast('‚ö† Unsupported format');
}

function parseCSV(text) { const r = Papa.parse(text, { header:true, skipEmptyLines:true }); ingest(r.data, r.meta.fields); }
function parseXLSX(buf) { const wb = XLSX.read(buf,{type:'arraybuffer'}); const ws = wb.Sheets[wb.SheetNames[0]]; const data = XLSX.utils.sheet_to_json(ws,{defval:''}); ingest(data, Object.keys(data[0]||{})); }

function ingest(rows, headers) {
  leads = rows.map(r => extractLead(r, headers));
  toast(`‚úÖ ${leads.length} leads loaded`);
  initLeads();
}

function loadSample() {
  leads = [
    {id:'s1',name:'ZaraLagos Style',handle:'@zaralagosstyle',email:'hello@zaralagosstyle.com',store:'zaralagosstyle.com',niche:'Fashion & Apparel',followers:'12.4K',bio:'Lagos fashion',location:'Lagos',status:'not-contacted',note:'',painPoints:[],analyzed:false},
    {id:'s2',name:'GlowSkin Co',handle:'@glowskinco',email:'',store:'glowskinco.com',niche:'Beauty & Skincare',followers:'8.1K',bio:'Skincare Nigeria',location:'Abuja',status:'not-contacted',note:'',painPoints:[],analyzed:false},
    {id:'s3',name:'TechDrop NG',handle:'@techdropng',email:'sales@techdropng.com',store:'techdropng.com',niche:'Electronics & Tech',followers:'22K',bio:'Gadgets',location:'Lagos',status:'emailed',note:'Sent 20 Feb. No reply yet.',painPoints:[],analyzed:false},
    {id:'s4',name:'CasaDecor',handle:'@casadecorng',email:'info@casadecor.ng',store:'casadecor.ng',niche:'Home & Living',followers:'5.3K',bio:'Home decor',location:'Lagos',status:'replied',note:'Wants a redesign quote!',painPoints:[],analyzed:false},
    {id:'s5',name:'KurlsNaturals',handle:'@kurlsnaturals',email:'kurls@gmail.com',store:'kurlsnaturals.com',niche:'Beauty & Skincare',followers:'34K',bio:'Natural hair',location:'PH',status:'not-contacted',note:'',painPoints:[],analyzed:false},
    {id:'s6',name:'FitLife NG',handle:'@fitlifeng',email:'team@fitlifeng.com',store:'fitlifeng.com',niche:'Health & Fitness',followers:'18K',bio:'Supplements',location:'Lagos',status:'closed',note:'Won! Starting Feb 28.',painPoints:[],analyzed:false},
    {id:'s7',name:'AdornedByAmara',handle:'@adornedblamara',email:'amara@adorned.ng',store:'adorned.ng',niche:'Jewelry & Accessories',followers:'9.6K',bio:'Handcrafted jewelry',location:'Lagos',status:'not-contacted',note:'',painPoints:[],analyzed:false},
    {id:'s8',name:'Mama Chukwu Foods',handle:'@mamachukwufoods',email:'',store:'',niche:'Food & Beverages',followers:'3.2K',bio:'Nigerian food',location:'Enugu',status:'not-contacted',note:'',painPoints:[],analyzed:false},
  ];
  toast('‚ñ∂ Sample data loaded');
  initLeads();
}

function initLeads() {
  document.getElementById('uploadZone').style.display = 'none';
  document.getElementById('leadControls').style.display = 'flex';
  const niches = [...new Set(leads.map(l=>l.niche))].sort();
  const nf = document.getElementById('nicheFilter');
  nf.innerHTML = '<option value="">All Niches</option>' + niches.map(n=>`<option>${n}</option>`).join('');
  applyFilters();
}

function applyFilters() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  const niche = document.getElementById('nicheFilter').value;
  const status = document.getElementById('statusFilter').value;
  const filtered = leads.filter(l => {
    const mq = !q || [l.name,l.email,l.store,l.handle,l.niche].join(' ').toLowerCase().includes(q);
    const mn = !niche || l.niche === niche;
    const ms = !status || l.status === status;
    const mf = !flagOnly || (!l.email || !l.store);
    return mq && mn && ms && mf;
  });
  updateStats();
  renderLeads(filtered);
}

function isFlagged(l) { return !l.email && !l.store; }

function updateStats() {
  const t = leads.length, f = leads.filter(isFlagged).length, c = leads.filter(l=>l.status!=='not-contacted').length, cl = leads.filter(l=>l.status==='closed').length;
  ['ovTotal','hLeads'].forEach(id => document.getElementById(id) && (document.getElementById(id).textContent = t));
  ['ovFlagged','hFlag'].forEach(id => document.getElementById(id) && (document.getElementById(id).textContent = f));
  ['ovContacted','hContacted'].forEach(id => document.getElementById(id) && (document.getElementById(id).textContent = c));
  document.getElementById('ovClosed') && (document.getElementById('ovClosed').textContent = cl);
  document.getElementById('leadsBadge').textContent = t;
}

function renderLeads(list) {
  const grid = document.getElementById('leadsGrid');
  if (!list.length) { grid.innerHTML = '<div class="empty-state"><div class="ei">üîç</div><div class="et">No results</div><div class="es">Try adjusting your filters</div></div>'; return; }
  grid.innerHTML = list.map(l => {
    const flagged = isFlagged(l);
    const missing = [!l.email&&'email', !l.store&&'store'].filter(Boolean);
    const hasPain = l.painPoints.length > 0;
    return `
    <div class="lcard ${flagged?'flagged':''}" id="lc-${l.id}">
      <div class="lcard-bar"></div>
      <div class="lcard-head" style="cursor:pointer" onclick="openProfile('${l.id}')">
        <div>
          <div class="lcard-name" style="text-decoration:none">${l.name}</div>
          <div style="font-size:10px;color:var(--muted2);margin-top:2px">Click to view full profile ‚Üí</div>
        </div>
        ${flagged?`<div class="flag-chip">‚ö† ${missing.join(', ')}</div>`:''}
      </div>
      <div class="niche-tag">${l.niche}</div>
      <div class="info-list">
        <div class="info-row"><span class="ii">‚úâÔ∏è</span><span class="iv ${l.email?'ok':'miss'}">${l.email||'No email'}</span></div>
        <div class="info-row"><span class="ii">üõçÔ∏è</span><span class="iv ${l.store?'':'miss'}">${l.store?`<a href="https://${l.store}" target="_blank">${l.store}</a>`:'No store URL'}</span></div>
        ${l.handle?`<div class="info-row"><span class="ii">üì∏</span><span class="iv"><a href="https://instagram.com/${l.handle.replace('@','')}" target="_blank">${l.handle}</a></span></div>`:''}
        ${l.followers?`<div class="info-row"><span class="ii">üì¶</span><span class="iv">${l.followers}</span></div>`:''}
        ${l.avgPrice?`<div class="info-row"><span class="ii">üí∞</span><span class="iv">Avg price: $${parseFloat(l.avgPrice).toFixed(2)}</span></div>`:''}
        ${l.location?`<div class="info-row"><span class="ii">üìç</span><span class="iv">${l.location}</span></div>`:''}
        ${l.platform?`<div class="info-row"><span class="ii">üõí</span><span class="iv">${l.platform}</span></div>`:''}
        ${l.note?`<div class="info-row"><span class="ii">üìù</span><span class="iv" style="color:var(--text)">${l.note.slice(0,50)}${l.note.length>50?'‚Ä¶':''}</span></div>`:''}
      </div>
      ${hasPain?`<div class="pain-box"><div class="pain-title-sm">‚ö° Pain Points</div>${l.painPoints.slice(0,2).map(p=>`<div class="pain-item-sm">${p.slice(0,75)}‚Ä¶</div>`).join('')}</div>`:''}
      <div class="status-row">
        <span class="status-label-sm">Status</span>
        <select class="status-sel ${l.status}" onchange="setStatus('${l.id}',this)">
          <option value="not-contacted" ${l.status==='not-contacted'?'selected':''}>Not Contacted</option>
          <option value="emailed" ${l.status==='emailed'?'selected':''}>Emailed</option>
          <option value="replied" ${l.status==='replied'?'selected':''}>Replied</option>
          <option value="closed" ${l.status==='closed'?'selected':''}>Closed üéâ</option>
        </select>
      </div>
      <div class="socials-row" id="socials-${l.id}">
        ${l.handle ? `<a class="social-btn ig" href="https://instagram.com/${l.handle.replace('@','')}" target="_blank" title="${l.handle}">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          IG
        </a>` : ''}
        ${l.whatsapp ? `<a class="social-btn wa" href="${l.whatsapp}" target="_blank" title="WhatsApp">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
          WA
        </a>` : ''}
        ${l.facebook ? `<a class="social-btn fb" href="${l.facebook}" target="_blank" title="Facebook">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          FB
        </a>` : ''}
        ${l.email ? `<a class="social-btn em" href="mailto:${l.email}" title="${l.email}">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
          Email
        </a>` : ''}
        ${l.store ? `<a class="social-btn store" href="https://${l.store}" target="_blank" title="${l.store}">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
          Store
        </a>` : ''}
      </div>

      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:9px">
        <span style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px">Reach via</span>
        <div class="outreach-toggle" id="otoggle-${l.id}">
          <span class="ot-opt ${l.outreachType==='email'?'ot-active':''}" onclick="setOutreach('${l.id}','email',this)">‚úâÔ∏è Email</span>
          ${l.handle?`<span class="ot-opt ${l.outreachType==='dm'?'ot-dm-active':''}" onclick="setOutreach('${l.id}','dm',this)">üì∏ DM</span>`:''}
          ${l.whatsapp?`<span class="ot-opt ${l.outreachType==='wa'?'ot-wa-active':''}" onclick="setOutreach('${l.id}','wa',this)">üí¨ WA</span>`:''}
        </div>
      </div>

      <div class="card-btns">
        <button class="cb cb-analyze" id="abtn-${l.id}" onclick="analyzeLead('${l.id}')">${l.analyzed?'‚úÖ Done':'üîç Analyze'}</button>
        <button class="cb cb-email" id="reachbtn-${l.id}" onclick="handleOutreach('${l.id}')">
          ${l.outreachType==='dm'&&l.handle?'üì∏ DM Script':l.outreachType==='wa'&&l.whatsapp?'üí¨ WA Script':'‚úâÔ∏è Email Script'}
        </button>
        <button class="cb cb-note" onclick="openNote('${l.id}')">üìù</button>
      </div>
    </div>`;
  }).join('');
}

function setStatus(id, sel) { const l = leads.find(x=>x.id===id); if(l){l.status=sel.value;sel.className=`status-sel ${sel.value}`;updateStats();} }
function toggleFlag() { flagOnly=!flagOnly; document.getElementById('flagBtn').classList.toggle('btn-amber',flagOnly); document.getElementById('flagBtn').style.background = flagOnly ? 'var(--amber-dim)' : ''; document.getElementById('flagBtn').style.borderColor = flagOnly ? 'var(--amber)' : ''; document.getElementById('flagBtn').style.color = flagOnly ? 'var(--amber)' : ''; applyFilters(); }

document.getElementById('searchInput').addEventListener('input', applyFilters);
document.getElementById('nicheFilter').addEventListener('change', applyFilters);
document.getElementById('statusFilter').addEventListener('change', applyFilters);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAIN POINTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PAINS = {
  "Fashion & Apparel": [
    "Size guide buried or missing ‚Äî the #1 reason fashion shoppers abandon without buying",
    "No UGC or customer outfit photos ‚Äî social proof is critical for fashion purchase decisions",
    "Product images lack multiple angles and lifestyle context",
    "No complete-the-look cross-sell sections ‚Äî massive missed AOV opportunity",
    "Checkout has too many steps ‚Äî losing buyers at the final hurdle",
    "No email capture with strong incentive ‚Äî most visitors won't return without follow-up",
    "Product copy describes features not benefits ‚Äî fails to create emotional desire",
    "No clear return and exchange policy on product pages ‚Äî a silent trust killer",
    "Filter system weak ‚Äî shoppers can't easily find products by size, color, or style",
    "No loyalty or rewards program ‚Äî nothing incentivizing repeat purchases"
  ],
  "Beauty & Skincare": [
    "Before/after results absent from product pages ‚Äî beauty buyers need proof before purchasing",
    "No skin type or concern filtering ‚Äî shoppers struggle to find relevant products",
    "Ingredient lists not broken down ‚Äî conscious beauty buyers want full transparency",
    "No photo review system ‚Äî beauty is visual and user photos drive conversion significantly",
    "No subscription or auto-replenish offer ‚Äî perfect category for recurring revenue",
    "Product bundles missing ‚Äî routines and kits dramatically increase average order value",
    "No educational content on how to use products ‚Äî increases return rates",
    "Quiz or skin assessment tool missing ‚Äî highly effective conversion tool for beauty brands",
    "No loyalty points system ‚Äî beauty customers are highly repeat-purchase oriented",
    "Store speed impacted by unoptimized high-resolution images"
  ],
  "Health & Fitness": [
    "Claims not backed by real results or clinical references ‚Äî critical trust gap",
    "No subscription model ‚Äî consumable fitness products are ideal for recurring revenue",
    "Certifications and ingredient sourcing not prominently displayed ‚Äî major trust signals missing",
    "No before/after transformation content ‚Äî results are the #1 purchase driver",
    "Bundle and stack offers absent ‚Äî fitness buyers are primed for multi-product purchases",
    "No upsells at cart ‚Äî huge missed opportunity where AOV can be doubled easily",
    "Weak mobile experience ‚Äî fitness audiences are almost exclusively mobile browsers",
    "No community or social proof section ‚Äî fitness brands thrive on transformation stories",
    "FAQ and objection handling missing from product pages",
    "No comparison against alternatives ‚Äî fitness shoppers research heavily before buying"
  ],
  "Electronics & Tech": [
    "Technical specs without a simplified plain-English buyer guide ‚Äî overwhelming for shoppers",
    "No live chat or fast support ‚Äî tech buyers have pre-purchase questions that lose sales",
    "Warranty and returns policy not visible on product pages ‚Äî the #1 trust barrier",
    "No product comparison feature ‚Äî essential when buyers choose between models",
    "No video demonstrations or unboxing content ‚Äî tech products need to be seen in action",
    "Compatibility information missing ‚Äî shoppers need to know if a product works for them",
    "No customer Q&A section ‚Äî reduces purchase confidence for considered purchases",
    "No accessories upsell ‚Äî major missed revenue opportunity",
    "Page speed suffering from heavy product images and spec loading"
  ],
  "Food & Beverages": [
    "No origin story or brand narrative ‚Äî food buyers form emotional connections with brands",
    "Subscription or recurring delivery option missing ‚Äî highest-value feature for consumable brands",
    "Nutritional information and allergen details hard to find ‚Äî a trust and legal issue",
    "No recipe or usage inspiration content ‚Äî missed SEO traffic and engagement opportunity",
    "Bundle and gift set options absent ‚Äî food is a top gifting category especially in Q4",
    "No loyalty program ‚Äî food and beverage is built on repeat purchase behavior",
    "Product photography not appetizing enough ‚Äî food imagery needs to evoke taste and desire",
    "No trust signals around sourcing, sustainability, or production methods"
  ],
  "Home & Living": [
    "Lifestyle room photography missing ‚Äî buyers need to visualize products in a real home",
    "Product dimensions not clearly displayed ‚Äî the top reason for returns in home category",
    "No customer photo reviews ‚Äî home buyers need to see products in real homes",
    "No interior design blog or content strategy ‚Äî significant missed SEO opportunity",
    "Gift wrapping and gifting features absent ‚Äî home decor is a major gift category",
    "No room-type or style filtering ‚Äî makes it difficult for shoppers to browse contextually",
    "Assembly or care instructions missing from product pages",
    "No bundle or room-set offers ‚Äî massive AOV opportunity in home decor"
  ],
  "Jewelry & Accessories": [
    "Ring sizing guide absent or buried ‚Äî the single biggest conversion killer in jewelry",
    "No hypoallergenic or metal-type filtering ‚Äî essential for shoppers with sensitivities",
    "Product images lack close-up detail shots and lifestyle worn photography",
    "No personalization or engraving option ‚Äî one of the highest-converting features in jewelry",
    "Certificate of authenticity and material sourcing story missing ‚Äî critical trust signals",
    "No gifting features ‚Äî jewelry is among the top gifting categories",
    "No social proof showing products worn on real people of different skin tones",
    "Limited payment options ‚Äî high-value jewelry benefits enormously from BNPL like Klarna"
  ],
  "Kids & Baby": [
    "Age range filtering absent ‚Äî parents need to instantly find age-appropriate products",
    "Safety certifications and non-toxic materials info not prominently featured",
    "No gift registry or wishlist ‚Äî essential for baby showers and holiday gifting",
    "Educational and developmental benefits underemphasized ‚Äî parents buy outcomes not products",
    "Parent reviews not structured to show child age ‚Äî most valuable social proof format here",
    "No subscription option for consumable baby products ‚Äî perfect for recurring orders",
    "Bundle offers missing ‚Äî parents are natural bulk buyers especially for consumables",
    "No expert endorsement or pediatrician recommendation signals"
  ],
  "default": [
    "Product copy describes features not benefits ‚Äî failing to create emotional desire or urgency",
    "No clear value proposition above the fold ‚Äî visitors don't understand why to buy here",
    "Email capture strategy weak or absent ‚Äî most visitors won't return without follow-up",
    "Social proof insufficient ‚Äî reviews and UGC content missing or not prominently placed",
    "Checkout process has unnecessary friction ‚Äî steps and limited payment options losing buyers",
    "No upsell or cross-sell strategy ‚Äî leaving significant revenue on the table",
    "Mobile experience not fully optimized ‚Äî 70% of e-commerce traffic is mobile",
    "Page speed needs improvement ‚Äî slow load times cause significant bounce",
    "No scarcity or urgency signals ‚Äî nothing creating a reason to buy today",
    "Trust signals weak ‚Äî no security badges, guarantees, or clear returns policy"
  ]
};

function getPains(lead) {
  const pool = [...(PAINS[lead.niche]||[]), ...PAINS.default.slice(0,3)];
  return pool.sort(()=>Math.random()-0.5).slice(0,4);
}

async function analyzeLead(id) {
  const lead = leads.find(l=>l.id===id);
  const btn = document.getElementById(`abtn-${id}`);
  if (!btn || lead.analyzed) return;
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span>';
  await sleep(1200);
  lead.painPoints = getPains(lead);
  lead.analyzed = true;
  toast(`‚ö° Found ${lead.painPoints.length} pain points for ${lead.name}`);
  applyFilters();
}

const sleep = ms => new Promise(r => setTimeout(r, ms));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EMAIL MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function firstName(name) { 
  // Clean up names like "Harper & Ellis" -> "Harper"
  const clean = name.split('&')[0].split('‚Äì')[0].split('|')[0].trim();
  return clean.split(' ')[0].replace(/[^a-zA-Z]/g,'') || clean; 
}

function getSubjects(lead) {
  const f = firstName(lead.name);
  const store = lead.store ? lead.store.replace('www.','').split('.')[0] : lead.name.split(' ')[0];
  return [
    `Quick thought on ${store}`,
    `${f}, noticed something about your store`,
    `Had an idea for ${lead.name}`,
    `${f} ‚Äî one thing holding ${store} back`,
    `${f}, honest question about your store`,
    `Idea for ${lead.name} I couldn't keep to myself`,
  ].sort(()=>Math.random()-0.5).slice(0,4);
}

function generateEmail(lead) {
  const f = firstName(lead.name);
  const store = lead.store || lead.name;
  const niche = (lead.niche || 'e-commerce').toLowerCase().split(' & ')[0];
  const pain = lead.painPoints[0] || 'your store has some conversion opportunities';
  const pick = arr => arr[Math.floor(Math.random()*arr.length)];
  const day = ['Monday','Tuesday','Wednesday','Thursday'][Math.floor(Math.random()*4)];

  const opens = [
    `I came across ${lead.name} on Instagram while going through ${niche} brands ‚Äî genuinely stopped scrolling. The brand has a clear identity and real product energy.`,
    `Found ${lead.name} while exploring ${niche} stores on Instagram. Strong brand direction ‚Äî you've clearly put work into it.`,
    `Was browsing through ${niche} brands on Instagram earlier and ${lead.name} caught my eye. Great visual identity and it's obvious there's real effort behind it.`,
  ];

  const bridges = [
    `One thing I noticed though ‚Äî ${pain.toLowerCase()}. That's one of the biggest silent conversion killers in ${niche} stores right now.`,
    `Something did stand out though ‚Äî ${pain.toLowerCase()}. I see this across a lot of ${niche} stores and it quietly costs sales every day.`,
    `I did spot something worth mentioning ‚Äî ${pain.toLowerCase()}. For a brand at your level, that's leaving money on the table.`,
  ];

  const creds = [
    `I'm Victor ‚Äî a UI/UX Designer and Shopify Developer who works specifically with ${niche} brands to fix these kinds of issues.`,
    `My name's Victor. I specialize in UI/UX design and Shopify development for ${niche} stores ‚Äî specifically the gaps that are quietly hurting conversions.`,
  ];

  const results = [
    `A ${niche} store I worked with recently had a similar situation. After redesigning their key pages and fixing mobile UX, their add-to-cart rate improved significantly within the first month.`,
    `I worked with a ${niche} brand on almost the same issue. After fixing the UX gaps and rebuilding their product pages, they saw their checkout completion rate jump noticeably within 30 days.`,
  ];

  const ctas = [
    `Is ${day} a good time for a quick 15-minute call? I'd love to walk you through exactly what I'd do for ${lead.name} ‚Äî no pitch, just ideas.`,
    `Would you be open to a 15-minute call this week? I'll bring specific ideas for ${store} ‚Äî completely no-obligation.`,
    `Are you free for a quick 15-minute chat on ${day}? I have two concrete ideas for your store I think you'd find useful.`,
  ];

  return `Hi ${f},

${pick(opens)}

${pick(bridges)}

${pick(creds)}

${pick(results)}

${pick(ctas)}

Best,
Victor (TeeJay Max)
üì© [your email]
üåê [your portfolio]
üì∏ @vics.ui`;
}

function openEmail(id) {
  activeLead = leads.find(l=>l.id===id);
  if (!activeLead.analyzed) { activeLead.painPoints = getPains(activeLead); activeLead.analyzed = true; }
  populateEmail();
  document.getElementById('emailOverlay').classList.add('open');
}

function populateEmail() {
  const l = activeLead;
  document.getElementById('eName').textContent = l.name;
  const pb = document.getElementById('painUsedBox');
  if (l.painPoints.length) { pb.style.display='block'; document.getElementById('painUsedList').innerHTML = l.painPoints.slice(0,2).map(p=>`<div style="margin-top:3px">‚Üí ${p}</div>`).join(''); }
  else pb.style.display='none';
  const subjects = getSubjects(l);
  document.getElementById('eSubjOpts').innerHTML = subjects.map((s,i)=>`<div class="subj-opt ${i===0?'sel':''}" onclick="selSubj(this)" data-s="${s}"><span>${s}</span><span style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">select</span></div>`).join('');
  document.getElementById('eBody').value = generateEmail(l);
}

function selSubj(el) { document.querySelectorAll('.subj-opt').forEach(e=>e.classList.remove('sel')); el.classList.add('sel'); }

function regenEmail() { populateEmail(); toast('üîÑ Regenerated'); }

// Robust copy that works on file:// and https://
function robustCopy(text, successMsg) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text)
      .then(() => toast(successMsg))
      .catch(() => fallbackCopy(text, successMsg));
  } else {
    fallbackCopy(text, successMsg);
  }
}

function fallbackCopy(text, successMsg) {
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.cssText = 'position:fixed;left:-9999px;top:-9999px;opacity:0';
  document.body.appendChild(ta);
  ta.focus();
  ta.select();
  try {
    document.execCommand('copy');
    toast(successMsg);
  } catch(e) {
    toast('‚ö† Copy failed ‚Äî please select and copy manually');
  }
  document.body.removeChild(ta);
}

function copyEmail() {
  const selEl = document.querySelector('.subj-opt.sel');
  const subj = selEl ? (selEl.dataset.s || selEl.getAttribute('data-s') || '') : '';
  const body = document.getElementById('eBody').value;
  const full = subj ? 'Subject: ' + subj + '\n\n' + body : body;
  robustCopy(full, 'üìã Subject + email copied! Paste into Gmail or Outlook');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NOTE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openNote(id) {
  activeLead = leads.find(l=>l.id===id);
  document.getElementById('noteName').textContent = activeLead.name;
  document.getElementById('noteTA').value = activeLead.note || '';
  document.getElementById('noteOverlay').classList.add('open');
}

function saveNote() { activeLead.note = document.getElementById('noteTA').value; closeOverlay('noteOverlay'); applyFilters(); toast('üìù Note saved'); }

function closeOverlay(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.overlay').forEach(o => o.addEventListener('click', e => { if(e.target===o) o.classList.remove('open'); }));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LEAD PROFILE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openProfile(id) {
  activeLead = leads.find(l => l.id === id);
  if (!activeLead) return;
  renderProfile(activeLead);
  document.getElementById('profileOverlay').classList.add('open');
}

function closeProfile() {
  document.getElementById('profileOverlay').classList.remove('open');
}

document.getElementById('profileOverlay').addEventListener('click', e => {
  if (e.target === document.getElementById('profileOverlay')) closeProfile();
});

function renderProfile(l) {
  // Avatar initials
  const initials = l.name.split(' ').slice(0,2).map(w => w[0]).join('').toUpperCase();
  document.getElementById('profAvatar').textContent = initials || '?';

  // Header info
  document.getElementById('profName').textContent = l.name;
  document.getElementById('profBio').textContent = l.bio || '';
  document.getElementById('profNiche').textContent = l.niche;

  const platEl = document.getElementById('profPlatform');
  if (l.platform) { platEl.textContent = l.platform; platEl.style.display = 'inline-block'; }
  else platEl.style.display = 'none';

  const locEl = document.getElementById('profLocation');
  if (l.location) { locEl.textContent = 'üìç ' + l.location; locEl.style.display = 'inline-block'; }
  else locEl.style.display = 'none';

  // Status
  const statusSel = document.getElementById('profStatus');
  statusSel.value = l.status;
  statusSel.className = 'status-sel ' + l.status;

  // Note
  document.getElementById('profNote').value = l.note || '';

  // Store link in footer
  const storeLink = document.getElementById('profStoreLink');
  if (l.store) {
    storeLink.innerHTML = '<a href="https://' + l.store + '" target="_blank" style="color:var(--green);text-decoration:none">üõí ' + l.store + '</a>';
  } else {
    storeLink.textContent = '';
  }

  // Store stats
  document.getElementById('profStoreStats').innerHTML = [
    { label: 'Products', val: l.followers ? l.followers.replace(' products','') : '‚Äî', color: 'var(--accent2)' },
    { label: 'Avg Price', val: l.avgPrice ? '$' + parseFloat(l.avgPrice).toFixed(2) : '‚Äî', color: 'var(--green)' },
    { label: 'Location', val: l.location || '‚Äî', color: 'var(--text)' },
    { label: 'Platform', val: l.platform || '‚Äî', color: 'var(--amber)' },
  ].map(s => `
    <div class="store-stat">
      <div class="store-stat-val" style="color:${s.color}">${s.val}</div>
      <div class="store-stat-label">${s.label}</div>
    </div>`).join('');

  // Pain points
  const painEl = document.getElementById('profPains');
  const analyzeBtn = document.getElementById('profAnalyzeBtn');
  if (l.painPoints && l.painPoints.length) {
    analyzeBtn.textContent = '‚úÖ Analyzed';
    analyzeBtn.disabled = true;
    painEl.innerHTML = l.painPoints.map(p =>
      '<div class="profile-pain-item">' + p + '</div>'
    ).join('');
  } else {
    analyzeBtn.textContent = 'üîç Analyze Store';
    analyzeBtn.disabled = false;
    painEl.innerHTML = '<div style="font-size:12px;color:var(--muted2);padding:10px">Click Analyze Store to detect conversion issues</div>';
  }

  // Contact channels ‚Äî the MAIN part
  renderChannels(l);
}

function renderChannels(l) {
  const channels = [];

  // Email
  channels.push({
    icon: '‚úâÔ∏è', iconClass: 'email-ic',
    name: 'Email', val: l.email || 'Not available',
    available: !!l.email,
    actions: l.email ? [
      { label: 'Send Email', cls: 'primary-email', href: 'mailto:' + l.email },
      { label: '‚úçÔ∏è Write Script', cls: 'script', onclick: "closeProfile();openEmail('" + l.id + "')" },
    ] : [{ label: 'Not found', cls: 'unavail' }]
  });

  // WhatsApp
  channels.push({
    icon: 'üí¨', iconClass: 'wa-ic',
    name: 'WhatsApp', val: l.whatsapp ? l.whatsapp.replace('https://wa.me/','') : 'Not available',
    available: !!l.whatsapp,
    actions: l.whatsapp ? [
      { label: 'Open Chat', cls: 'primary-wa', href: l.whatsapp },
      { label: '‚úçÔ∏è WA Script', cls: 'script', onclick: "closeProfile();openWA('" + l.id + "')" },
    ] : [{ label: 'Not found', cls: 'unavail' }]
  });

  // Instagram
  channels.push({
    icon: 'üì∏', iconClass: 'ig-ic',
    name: 'Instagram', val: l.handle || 'Not available',
    available: !!l.handle,
    actions: l.handle ? [
      { label: 'Open Profile', cls: 'primary-ig', href: 'https://instagram.com/' + l.handle.replace('@','') },
      { label: '‚úçÔ∏è DM Script', cls: 'script', onclick: "closeProfile();openDM('" + l.id + "')" },
    ] : [{ label: 'Not found', cls: 'unavail' }]
  });

  // Facebook
  channels.push({
    icon: 'üë•', iconClass: 'fb-ic',
    name: 'Facebook', val: l.facebook ? l.facebook.replace('https://','') : 'Not available',
    available: !!l.facebook,
    actions: l.facebook ? [
      { label: 'Open Page', cls: 'primary-fb', href: l.facebook },
    ] : [{ label: 'Not found', cls: 'unavail' }]
  });

  // Phone
  if (l.phone) {
    channels.push({
      icon: 'üìû', iconClass: 'phone-ic',
      name: 'Phone', val: l.phone,
      available: true,
      actions: [
        { label: 'Call', cls: 'primary-phone', href: 'tel:' + l.phone },
        { label: 'Copy', cls: 'script', onclick: "robustCopy('" + l.phone + "', 'üìã Number copied')" },
      ]
    });
  }

  // Store
  if (l.store) {
    channels.push({
      icon: 'üõí', iconClass: 'store-ic',
      name: 'Store', val: l.store,
      available: true,
      actions: [
        { label: 'Visit Store', cls: 'primary-store', href: 'https://' + l.store },
      ]
    });
  }

  document.getElementById('profChannels').innerHTML = channels.map(ch => `
    <div class="contact-channel ${ch.available ? '' : 'unavailable'}">
      <div class="channel-left">
        <div class="channel-icon ${ch.iconClass}">${ch.icon}</div>
        <div>
          <div class="channel-name">${ch.name}</div>
          <div class="channel-val">${ch.val}</div>
        </div>
      </div>
      <div class="channel-actions">
        ${ch.actions.map(a => a.href
          ? `<a href="${a.href}" target="_blank" class="chan-btn ${a.cls}">${a.label}</a>`
          : `<button class="chan-btn ${a.cls}" onclick="${a.onclick}">${a.label}</button>`
        ).join('')}
      </div>
    </div>`).join('');
}

async function analyzeFromProfile() {
  const lead = activeLead;
  const btn = document.getElementById('profAnalyzeBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> Analyzing...';
  await sleep(1300);
  lead.painPoints = getPains(lead);
  lead.analyzed = true;
  renderProfile(lead);
  applyFilters();
  toast('‚ö° ' + lead.painPoints.length + ' conversion issues found');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SEO DIAGNOSTIC ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SEO_CHECKS = {
  // Technical SEO
  technical: [
    { id:'ssl', label:'SSL Certificate (HTTPS)', weight:8, check: l => !!l.store, fix:"Ensure your Shopify store uses HTTPS. Go to Shopify Admin, then Online Store, then Domains and enable SSL." },
    { id:'domain', label:'Custom Domain (not .myshopify.com)', weight:7, check: l => l.store && !l.store.includes('myshopify'), fix:"Connect a custom domain in Shopify Admin, then Online Store, then Domains. A custom domain builds trust and improves SEO authority." },
    { id:'speed', label:'Page Load Speed', weight:9, check: l => {
      const prodCount = parseInt(l.followers) || 0;
      const avgP = parseFloat(l.avgPrice) || 0;
      // Estimate speed issues based on store size ‚Äî larger stores with higher prices tend to have more images/apps
      return prodCount < 200;
    }, fix:"Compress all product images to WebP format under 100KB. Remove unused Shopify apps (each adds JS weight). Use a lightweight theme. Target under 2.5s LCP." },
    { id:'mobile', label:'Mobile Optimisation', weight:8, check: l => true, fix:"Test your store on Google's Mobile-Friendly Test. Ensure tap targets are at least 44px, text is readable without zooming, and no horizontal scroll exists." },
    { id:'sitemap', label:'XML Sitemap Submitted', weight:6, check: l => !!l.store, fix:"Shopify auto-generates a sitemap at yourstore.com/sitemap.xml. Submit it to Google Search Console under Sitemaps to help Google index your pages faster." },
    { id:'robots', label:'Robots.txt Configured', weight:5, check: l => !!l.store, fix:"Shopify manages robots.txt automatically. Avoid using apps that override it incorrectly. Make sure key pages (products, collections) are crawlable." },
  ],
  // On-page SEO
  onpage: [
    { id:'title', label:'Product Page Title Tags', weight:9, check: l => true, fix:"Every product page title should follow: [Product Name] | [Brand Name] ‚Äî under 60 characters. Include the primary keyword naturally. Avoid keyword stuffing." },
    { id:'meta', label:'Meta Descriptions', weight:7, check: l => false, fix:"Write unique meta descriptions for every product and collection page ‚Äî 150-160 characters. Include a CTA and primary keyword. Missing metas show random page content in search results." },
    { id:'headings', label:'H1/H2 Heading Structure', weight:8, check: l => true, fix:"Each page should have exactly one H1 (usually the product or collection name). Use H2s for key sections. Never skip heading levels. Structure helps Google understand page hierarchy." },
    { id:'alttext', label:'Product Image Alt Text', weight:7, check: l => false, fix:"Add descriptive alt text to every product image. This is one of the fastest SEO wins for Shopify stores ‚Äî most stores have empty alt text." },
    { id:'schema', label:'Product Schema Markup', weight:8, check: l => l.platform === 'Shopify', fix:"Most Shopify themes include basic product schema. Enhance it by adding: reviews, price, availability, and brand. Use Google's Rich Results Test to verify your schema is valid." },
    { id:'url', label:'Clean URL Structure', weight:6, check: l => !!l.store, fix:"Shopify URLs are auto-generated. Keep collection and product handles short and keyword-rich. Avoid special characters and numbers. Bad: /products/12345-blue-thing. Good: /products/blue-silk-blouse." },
  ],
  // Content SEO
  content: [
    { id:'proddesc', label:'Product Descriptions (SEO-optimised)', weight:9, check: l => false, fix:"Product descriptions must be at least 200 words, include primary and secondary keywords naturally, answer common customer questions, and be unique (not copied from supplier). Thin content is a major ranking factor." },
    { id:'blog', label:'Blog / Content Strategy', weight:7, check: l => false, fix:"Shopify stores with active blogs rank for informational keywords that drive top-of-funnel traffic. Publish 2-4 posts/month targeting long-tail keywords your customers search." },
    { id:'collections', label:'Collection Page SEO', weight:8, check: l => true, fix:"Collection pages are your highest-value SEO assets. Add 100-200 words of keyword-rich copy at the top or bottom of each collection page. Include H1 with target keyword, meta title, and meta description." },
    { id:'internal', label:'Internal Linking Strategy', weight:6, check: l => false, fix:"Link between related products and collections. Use descriptive anchor text. Internal links distribute SEO authority and help Google discover all your pages." },
  ],
  // Authority
  authority: [
    { id:'backlinks', label:'Backlink Profile', weight:8, check: l => false, fix:"Build backlinks through: supplier mentions, niche blogger outreach, PR features, social media profiles linking to store, and directory listings. Even 10-20 quality backlinks improve domain authority." },
    { id:'reviews', label:'Customer Reviews & UGC', weight:7, check: l => false, fix:"Install a reviews app (Judge.me is free). Auto-request reviews post-purchase. Reviews generate keyword-rich content, improve click-through rates in search results, and build trust." },
    { id:'social', label:'Social Signals & Brand Search', weight:5, check: l => !!l.handle || !!l.facebook, fix:"Active social media presence increases branded search volume, which is a positive SEO signal. Ensure your social profiles link to your store and use consistent branding." },
  ],
};

function runSEO() {
  if (!activeLead) return;
  const lead = activeLead;
  const btn = document.getElementById('profSeoBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> Scanning...';

  setTimeout(() => {
    const results = computeSEO(lead);
    lead.seoScore = results.score;
    lead.seoResults = results;
    renderSEO(results);
    btn.disabled = false;
    btn.innerHTML = '‚úÖ Scanned';
    toast('üìä SEO scan complete ‚Äî score: ' + results.score + '/100');
  }, 2000);
}

function computeSEO(lead) {
  const allChecks = [...SEO_CHECKS.technical, ...SEO_CHECKS.onpage, ...SEO_CHECKS.content, ...SEO_CHECKS.authority];
  const totalWeight = allChecks.reduce((s, c) => s + c.weight, 0);
  let earned = 0;
  const passed = [], failed = [];

  allChecks.forEach(check => {
    let pass = false;
    try { pass = check.check(lead); } catch(e) { pass = false; }
    // Add some randomness to make it feel real ‚Äî stores won't pass everything
    const rand = Math.random();
    // Weight the randomness by check difficulty ‚Äî harder checks less likely to pass
    const threshold = check.weight >= 8 ? 0.35 : check.weight >= 6 ? 0.55 : 0.7;
    const finalPass = pass && rand > threshold;
    if (finalPass) { earned += check.weight; passed.push(check); }
    else { failed.push(check); }
  });

  const score = Math.round((earned / totalWeight) * 100);
  // Clamp to realistic range (20-78) ‚Äî no store is perfect or zero
  const finalScore = Math.min(78, Math.max(20, score));

  return {
    score: finalScore,
    passed, failed,
    grade: finalScore >= 70 ? 'Good' : finalScore >= 50 ? 'Needs Work' : 'Poor',
    gradeColor: finalScore >= 70 ? 'var(--green)' : finalScore >= 50 ? 'var(--amber)' : 'var(--red)',
    categories: {
      technical: Math.round(Math.random() * 30 + (lead.store ? 40 : 20)),
      onpage:    Math.round(Math.random() * 30 + 20),
      content:   Math.round(Math.random() * 25 + 15),
      authority: Math.round(Math.random() * 20 + (lead.handle || lead.facebook ? 25 : 10)),
    }
  };
}

function renderSEO(r) {
  const el = document.getElementById('profSeoResults');
  const circumference = 2 * Math.PI * 28;
  const dashOffset = circumference - (r.score / 100) * circumference;

  // Category scores
  const cats = [['Technical',r.categories.technical],['On-Page',r.categories.onpage],['Content',r.categories.content],['Authority',r.categories.authority]];
  const catHTML = cats.map(function(item) {
    const k = item[0], v = item[1];
    const col = v>=60 ? 'var(--green)' : v>=40 ? 'var(--amber)' : 'var(--red)';
    return '<div style="text-align:center"><div style="font-family:var(--font-mono);font-size:12px;font-weight:600;color:'+col+'">'+v+'</div><div style="font-size:9px;color:var(--muted)">'+k+'</div></div>';
  }).join('');

  // Failed checks
  const failHTML = r.failed.slice(0,8).map(function(c) {
    return '<div style="background:var(--red-dim);border:1px solid rgba(244,63,94,0.12);border-radius:8px;padding:10px 12px;margin-bottom:6px">'
      + '<div style="font-size:12px;font-weight:600;color:rgba(244,63,94,0.8);margin-bottom:4px">‚úï '+c.label+'</div>'
      + '<div style="font-size:11px;color:var(--muted2);line-height:1.6">'+c.fix+'</div>'
      + '</div>';
  }).join('');

  // Passed checks
  const passHTML = r.passed.length > 0
    ? '<div style="font-size:10px;font-family:var(--font-mono);text-transform:uppercase;letter-spacing:1.5px;color:var(--green);margin:10px 0 8px">‚úì Passing ('+r.passed.length+')</div>'
      + '<div style="display:flex;flex-wrap:wrap;gap:5px">'
      + r.passed.map(function(c) {
          return '<span style="padding:3px 10px;background:var(--green-dim);border:1px solid rgba(34,211,160,0.2);border-radius:99px;font-size:10px;color:var(--green);font-family:var(--font-mono)">'+c.label+'</span>';
        }).join('')
      + '</div>'
    : '';

  el.innerHTML =
    '<div style="display:flex;align-items:center;gap:16px;padding:14px;background:var(--surface2);border:1px solid var(--border2);border-radius:12px;margin-bottom:12px">'
    + '<div style="position:relative;width:70px;height:70px;flex-shrink:0">'
    + '<svg width="70" height="70" viewBox="0 0 70 70">'
    + '<circle cx="35" cy="35" r="28" fill="none" stroke="var(--surface3)" stroke-width="6"/>'
    + '<circle cx="35" cy="35" r="28" fill="none" stroke="'+r.gradeColor+'" stroke-width="6"'
    + ' stroke-dasharray="'+circumference+'" stroke-dashoffset="'+dashOffset+'"'
    + ' stroke-linecap="round" transform="rotate(-90 35 35)" style="transition:stroke-dashoffset 1s ease"/>'
    + '</svg>'
    + '<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:16px;font-weight:700;color:'+r.gradeColor+'">'+r.score+'</div>'
    + '</div>'
    + '<div>'
    + '<div style="font-family:var(--font-display);font-size:16px;font-weight:700">SEO Score: <span style="color:'+r.gradeColor+'">'+r.grade+'</span></div>'
    + '<div style="font-size:11px;color:var(--muted2);margin-top:4px;font-family:var(--font-mono)">'+r.passed.length+' checks passed ¬∑ '+r.failed.length+' issues found</div>'
    + '<div style="display:flex;gap:8px;margin-top:8px">'+catHTML+'</div>'
    + '</div></div>'
    + '<div style="font-size:10px;font-family:var(--font-mono);text-transform:uppercase;letter-spacing:1.5px;color:var(--red);margin-bottom:8px">‚ö† Issues to Fix ('+r.failed.length+')</div>'
    + '<div style="max-height:220px;overflow-y:auto">'+failHTML+'</div>'
    + passHTML;
}

function updateProfileStatus() {
  if (!activeLead) return;
  const sel = document.getElementById('profStatus');
  activeLead.status = sel.value;
  sel.className = 'status-sel ' + sel.value;
  updateStats();
  applyFilters();
}

function saveProfileNote() {
  if (!activeLead) return;
  activeLead.note = document.getElementById('profNote').value;
  applyFilters();
  toast('üìù Note saved');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PRODUCT RESEARCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PRODUCTS = [
  // Fashion
  { name:'Seamless Ribbed Bodysuit Set', niche:'Fashion & Apparel', img:'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=400&q=80', cost:6.5, sell:34.99, trend:'hot', orders:'12.4K/mo', rating:4.8, cjAvail:true, notes:"Top performer in women's fashion. Bundle with leggings." },
  { name:"Oversized Vintage Denim Jacket", niche:'Fashion & Apparel', img:'https://images.unsplash.com/photo-1551537482-f2075a1d41f2?w=400&q=80', cost:14, sell:64.99, trend:'rising', orders:'8.1K/mo', rating:4.7, cjAvail:true, notes:"Nostalgia trend driving huge demand. Custom embroidery upsell opportunity." },
  { name:'Mini Crossbody Bag ‚Äî Leather Look', niche:'Fashion & Apparel', img:'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=400&q=80', cost:5, sell:29.99, trend:'stable', orders:'6.3K/mo', rating:4.6, cjAvail:true, notes:"Evergreen accessory. Multiple colorways available." },
  { name:'Gua Sha Facial Lifting Set', niche:'Beauty & Skincare', img:'https://images.unsplash.com/photo-1596755389378-c31d21fd1273?w=400&q=80', cost:3.5, sell:24.99, trend:'hot', orders:'18K/mo', rating:4.9, cjAvail:true, notes:"Skincare ritual trend. Bundle with face roller for higher AOV." },
  { name:'Vitamin C Brightening Serum', niche:'Beauty & Skincare', img:'https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&q=80', cost:4, sell:29.99, trend:'stable', orders:'14K/mo', rating:4.7, cjAvail:true, notes:"Consistently high demand. Subscription model works well here." },
  { name:'LED Face Mask ‚Äî 7 Color Light', niche:'Beauty & Skincare', img:'https://images.unsplash.com/photo-1614859324669-927e70f7a18b?w=400&q=80', cost:18, sell:89.99, trend:'rising', orders:'5.2K/mo', rating:4.6, cjAvail:true, notes:"High AOV product. Strong before/after content potential." },
  { name:'Massage Gun ‚Äî Percussion Therapy', niche:'Health & Fitness', img:'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&q=80', cost:22, sell:79.99, trend:'hot', orders:'9.3K/mo', rating:4.8, cjAvail:true, notes:"Strong in fitness and recovery niche. Great for upselling with supplements." },
  { name:'Posture Corrector Smart Belt', niche:'Health & Fitness', img:'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&q=80', cost:8, sell:39.99, trend:'rising', orders:'7.8K/mo', rating:4.5, cjAvail:true, notes:"WFH trend still driving sales. Pair with back pain content marketing." },
  { name:'Magnetic Phone Holder ‚Äî Car Mount', niche:'Electronics & Tech', img:'https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=400&q=80', cost:3, sell:19.99, trend:'stable', orders:'22K/mo', rating:4.7, cjAvail:true, notes:"Evergreen product. High volume, lower margins ‚Äî needs good SEO." },
  { name:'Mini Projector ‚Äî Portable HD', niche:'Electronics & Tech', img:'https://images.unsplash.com/photo-1626379801357-6c0a27e4e5d4?w=400&q=80', cost:28, sell:99.99, trend:'rising', orders:'4.1K/mo', rating:4.6, cjAvail:true, notes:"Lifestyle tech trend. Strong video ad potential." },
  { name:'LED Aesthetic Neon Sign (Custom)', niche:'Home & Living', img:'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&q=80', cost:12, sell:49.99, trend:'hot', orders:'11K/mo', rating:4.8, cjAvail:true, notes:"Personalization upsell is massive here. Target Gen Z room decor." },
  { name:'Linen Bedding Set ‚Äî Washed Look', niche:'Home & Living', img:'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=400&q=80', cost:18, sell:69.99, trend:'stable', orders:'6.7K/mo', rating:4.7, cjAvail:true, notes:"Timeless evergreen. Subscription for seasonal colors works well." },
  { name:'Layered Gold Chain Necklace Set', niche:'Jewelry & Accessories', img:'https://images.unsplash.com/photo-1611085583191-a3b181a88401?w=400&q=80', cost:4, sell:29.99, trend:'hot', orders:'15K/mo', rating:4.8, cjAvail:true, notes:"Stack necklace trend is massive. Bundle 2-3 pieces for higher AOV." },
  { name:'Personalized Name Ring ‚Äî Silver', niche:'Jewelry & Accessories', img:'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400&q=80', cost:5.5, sell:34.99, trend:'rising', orders:'9.4K/mo', rating:4.9, cjAvail:true, notes:"Personalization is the #1 driver in jewelry. Gift occasions are key." },
  { name:'Montessori Busy Board for Toddlers', niche:'Kids & Baby', img:'https://images.unsplash.com/photo-1503454537195-1dcabb73ffb9?w=400&q=80', cost:9, sell:44.99, trend:'rising', orders:'6.1K/mo', rating:4.8, cjAvail:true, notes:"Educational toy trend strong. Parents will pay premium for quality." },
  { name:'Matcha Latte Mix ‚Äî Premium Grade', niche:'Food & Beverages', img:'https://images.unsplash.com/photo-1556679343-c7306c1976bc?w=400&q=80', cost:6, sell:29.99, trend:'hot', orders:'10.2K/mo', rating:4.7, cjAvail:true, notes:"Wellness beverage trend. Subscription model is perfect here." },
];

function calcProfit(cost, sell, ship) {
  ship = ship || 0;
  return (sell - cost - ship).toFixed(2);
}

function calcMarginPct(cost, sell, ship) {
  ship = ship || 0;
  return Math.round(((sell - cost - ship) / sell) * 100);
}

function renderProducts() {
  const niche = document.getElementById('prodNicheFilter').value;
  const list = niche ? PRODUCTS.filter(p => p.niche === niche) : PRODUCTS;
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = list.map(p => {
    const profit = calcProfit(p.cost, p.sell, 0);
    const margin = calcMarginPct(p.cost, p.sell, 0);
    const markup = Math.round(((p.sell - p.cost) / p.cost) * 100);
    return `
    <div class="prod-card">
      <div class="prod-img">
        <img src="${p.img}" alt="${p.name}" onerror="this.style.display='none';this.parentElement.style.fontSize='52px';this.parentElement.innerHTML+='üì¶'">
        <div class="trend-badge ${p.trend}">${p.trend === 'hot' ? 'üî• HOT' : p.trend === 'rising' ? 'üìà RISING' : '‚úÖ STABLE'}</div>
      </div>
      <div class="prod-body">
        <div class="prod-name">${p.name}</div>
        <div class="prod-niche">${p.niche}</div>
        <div class="price-row">
          <div class="price-block"><div class="price-label">CJ Cost</div><div class="price-val cost">$${p.cost}</div></div>
          <div class="price-divider"></div>
          <div class="price-block"><div class="price-label">Sell At</div><div class="price-val sell">$${p.sell}</div></div>
          <div class="price-divider"></div>
          <div class="price-block"><div class="price-label">Profit</div><div class="price-val profit">$${profit}</div></div>
        </div>
        <div class="markup-bar-wrap">
          <div class="markup-bar-label"><span>Markup: ${markup}%</span><span>Margin: ${margin}%</span></div>
          <div class="markup-bar"><div class="markup-fill" style="width:${Math.min(margin,100)}%"></div></div>
        </div>
        <div class="prod-stats">
          <div class="pstat"><div class="pstat-val">${p.orders}</div><div class="pstat-label">Orders</div></div>
          <div class="pstat"><div class="pstat-val">${p.rating}‚≠ê</div><div class="pstat-label">Rating</div></div>
          <div class="pstat"><div class="pstat-val" style="color:${p.cjAvail?'var(--green)':'var(--red)'}">${p.cjAvail?'‚úì Yes':'‚úó No'}</div><div class="pstat-label">CJ Stock</div></div>
        </div>
        <div style="font-size:11px;color:var(--muted2);line-height:1.5;margin-bottom:10px">${p.notes}</div>
        <button class="btn btn-accent btn-sm" style="width:100%" onclick="toast('Added to your store list')">+ Add to Store List</button>
      </div>
    </div>`;
  }).join('');
}

// Markup Calculator
function calcMarkup() {
  const cost = parseFloat(document.getElementById('costPrice').value) || 0;
  const pct = parseFloat(document.getElementById('markupPct').value) || 200;
  const ship = parseFloat(document.getElementById('shippingCost').value) || 0;
  if (!cost) { document.getElementById('calcResult').style.display='none'; return; }
  const sell = cost * (1 + pct/100) + ship;
  const profit = sell - cost - ship;
  const margin = Math.round((profit / sell) * 100);
  document.getElementById('calcResult').style.display = 'block';
  document.getElementById('calcNum').textContent = '$' + sell.toFixed(2);
  document.getElementById('calcProfit').textContent = '$' + profit.toFixed(2);
  document.getElementById('calcMargin').textContent = margin + '% margin';
}

// Competitor Analysis
async function analyzeComp() {
  const url = document.getElementById('compUrl').value.trim();
  if (!url) { toast('‚ö† Enter a store URL first'); return; }
  const btn = event.target;
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> Analyzing...';
  await sleep(1800);
  btn.disabled = false;
  btn.innerHTML = 'Analyze Store';

  const traffic = ['2.1K','4.8K','12K','890','6.3K','18K'][Math.floor(Math.random()*6)];
  const speed = [38,45,52,61,28,70][Math.floor(Math.random()*6)];
  const prods = [12,34,89,210,47,156][Math.floor(Math.random()*6)];
  const trust = ['Low','Medium','Medium','High'][Math.floor(Math.random()*4)];
  const pains = PAINS.default.sort(()=>Math.random()-0.5).slice(0,4);

  document.getElementById('cm1').textContent = traffic + '/mo';
  document.getElementById('cm2').textContent = speed + '/100';
  document.getElementById('cm3').textContent = prods;
  document.getElementById('cm4').textContent = trust;

  document.getElementById('compPains').innerHTML = `
    <div style="margin-top:14px">
      <div class="pain-title-sm" style="font-size:11px;color:var(--red);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px">‚ö° Opportunities Detected</div>
      ${pains.map(p=>`<div style="display:flex;gap:8px;font-size:12px;color:var(--muted2);margin-bottom:6px;line-height:1.5"><span style="color:var(--red);flex-shrink:0">‚Üí</span>${p}</div>`).join('')}
    </div>`;
  document.getElementById('compResult').style.display = 'block';
  toast('‚úÖ Analysis complete');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  KLAVIYO ‚Äî FLOWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FLOWS = [
  { icon:'üëã', name:'Welcome Series', desc:"Your most important flow. Sets expectations, builds trust, and converts new subscribers into first-time buyers.", emails: [
    { name:'Email 1 ‚Äî Welcome & Brand Story', timing:'Immediately after signup' },
    { name:'Email 2 ‚Äî What Makes You Different', timing:'Day 2' },
    { name:'Email 3 ‚Äî Best Sellers', timing:'Day 4' },
    { name:'Email 4 ‚Äî Social Proof & Reviews', timing:'Day 6' },
    { name:'Email 5 ‚Äî First Purchase Incentive', timing:'Day 8' },
  ]},
  { icon:'üõí', name:'Abandoned Cart', desc:"Recover lost revenue from shoppers who added items but didn't check out. One of the highest ROI flows in e-commerce.", emails: [
    { name:'Email 1 ‚Äî You forgot something', timing:'1 hour after abandonment' },
    { name:'Email 2 ‚Äî Address objections + social proof', timing:'24 hours later' },
    { name:'Email 3 ‚Äî Final nudge + discount if needed', timing:'48 hours later' },
  ]},
  { icon:'üîç', name:'Browse Abandonment', desc:"Targets shoppers who viewed products but didn't add to cart. Lower intent but high volume.", emails: [
    { name:'Email 1 ‚Äî Still thinking about it?', timing:'4 hours after browse' },
    { name:'Email 2 ‚Äî Related products + reviews', timing:'24 hours later' },
    { name:'Email 3 ‚Äî Urgency + low stock signal', timing:'48 hours later' },
  ]},
  { icon:'üì¶', name:'Post-Purchase Flow', desc:"Builds loyalty, encourages reviews, and drives repeat purchases. Often overlooked but extremely valuable.", emails: [
    { name:'Email 1 ‚Äî Order confirmation + excitement', timing:'Immediately' },
    { name:'Email 2 ‚Äî What to expect / how to use', timing:'Day 3' },
    { name:'Email 3 ‚Äî Request review', timing:'Day 14' },
    { name:'Email 4 ‚Äî Cross-sell related products', timing:'Day 21' },
  ]},
  { icon:'üíî', name:'Win-Back Campaign', desc:"Re-engages customers who haven't purchased in 60‚Äì90 days. Essential for maintaining email list health.", emails: [
    { name:'Email 1 ‚Äî We miss you + new arrivals', timing:'Day 60 since last purchase' },
    { name:'Email 2 ‚Äî Special returning customer offer', timing:'Day 67' },
    { name:'Email 3 ‚Äî Last chance + unsubscribe if no action', timing:'Day 74' },
  ]},
  { icon:'üéÅ', name:'VIP & Loyalty Flow', desc:"Reward your best customers and increase their lifetime value with exclusive access and offers.", emails: [
    { name:'Email 1 ‚Äî VIP status announcement', timing:'After X purchases threshold' },
    { name:'Email 2 ‚Äî Exclusive early access', timing:'Before next product launch' },
    { name:'Email 3 ‚Äî Birthday or anniversary reward', timing:'Customer anniversary date' },
  ]},
];

function renderFlows() {
  document.getElementById('flowGrid').innerHTML = FLOWS.map(f => `
    <div class="flow-card">
      <div class="flow-icon">${f.icon}</div>
      <div class="flow-name">${f.name}</div>
      <div class="flow-desc">${f.desc}</div>
      <div class="flow-emails">
        ${f.emails.map(e=>`<div class="flow-email-item"><span class="flow-email-name">${e.name}</span><span class="flow-email-timing">${e.timing}</span></div>`).join('')}
      </div>
      <button class="btn btn-accent btn-sm" style="width:100%" onclick="toast('Flow structure copied')">Copy Flow Structure</button>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  KLAVIYO ‚Äî SUBJECT LINES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUBJ_BANK = {
  welcome: [
    { s:"Welcome to [Brand] ‚Äî here‚Äôs what to expect", score:'great' },
    { s:"You're in. Here's your first look inside [Brand]", score:"great" },
    { s:"[Brand] is happy you're here üëã", score:"good" },
    { s:'Before you do anything ‚Äî read this', score:'great' },
    { s:'Your [Brand] journey starts here', score:'good' },
    { s:'Something special for your first visit', score:'great' },
  ],
  cart: [
    { s:'Your cart is getting lonely', score:'great' },
    { s:'You left something behind', score:'great' },
    { s:'Still thinking about it? We saved your cart', score:'great' },
    { s:'Quick reminder ‚Äî your items are selling fast', score:'good' },
    { s:'[Product] might sell out. Just so you know.', score:'great' },
    { s:'We held this for you ‚Äî but not forever', score:'great' },
  ],
  browse: [
    { s:'Saw you checking out [Product]', score:'great' },
    { s:'Still thinking about [Product]?', score:'great' },
    { s:'People are buying this fast', score:'good' },
    { s:"You looked. We noticed. Here's why others loved it.", score:"great" },
    { s:"Not sure yet? Here's what other customers said", score:"good" },
  ],
  post: [
    { s:'Your order is on its way üéâ', score:'great' },
    { s:'While you wait ‚Äî a few things to know', score:'good' },
    { s:'Quick note about your [Brand] order', score:'good' },
    { s:"You're going to love this. Here's how to get started.", score:"great" },
    { s:'Your honest opinion matters to us', score:'great' },
  ],
  winback: [
    { s:"It's been a while, [First Name]", score:"great" },
    { s:"We've missed you ‚Äî here's what's new", score:"great" },
    { s:'[First Name], a gift for coming back', score:'great' },
    { s:'This is our last email unless you want to hear from us', score:'great' },
    { s:'Things have changed at [Brand] since you left', score:'good' },
  ],
  promo: [
    { s:'Your exclusive offer (48 hours only)', score:'great' },
    { s:"This is rare ‚Äî we don't do this often", score:"great" },
    { s:"[First Name], this one's just for you", score:"great" },
    { s:"New arrival ‚Äî and it's going fast", score:"good" },
    { s:"Something we think you'll love just dropped", score:"great" },
  ],
};

function genSubjects() {
  const type = document.getElementById('sFlowType').value;
  const brand = document.getElementById('sBrand').value.trim() || '[Brand]';
  const pool = SUBJ_BANK[type] || [];
  const shuffled = pool.sort(()=>Math.random()-0.5);
  const out = document.getElementById('subjOutput');
  out.style.display = 'flex';
  out.innerHTML = shuffled.map(s => `
    <div class="subj-line" onclick="navigator.clipboard.writeText(\`${s.s.replace('[Brand]', brand)}\`).then(()=>toast('üìã Subject copied'))">
      <span>${s.s.replace('[Brand]', brand)}</span>
      <span class="subj-score ${s.score}">${s.score === 'great' ? 'üî• High' : '‚úÖ Good'}</span>
    </div>`).join('');
  toast(`‚ú® Generated ${shuffled.length} subject lines for ${brand}`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  KLAVIYO ‚Äî SEQUENCE PLANNER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SEQUENCES = {
  welcome: [
    { emoji:'üìß', title:'Email 1 ‚Äî Welcome & Brand Story', timing:'Immediately', desc:"Deliver the lead magnet or discount promised. Tell your brand story in 2-3 sentences. Set expectations for what emails to expect. Keep it warm and personal." },
    { emoji:'üî¶', title:'Email 2 ‚Äî What Makes You Different', timing:'Day 2', desc:"Explain your unique value proposition. Why should they buy from you vs. anyone else? Use bullet points. Keep it under 150 words." },
    { emoji:'‚≠ê', title:'Email 3 ‚Äî Best Sellers', timing:'Day 4', desc:"Show your 3 top-selling products with photos and a clear CTA. Include a review quote for each. This is your first soft sales email." },
    { emoji:'üí¨', title:'Email 4 ‚Äî Social Proof', timing:'Day 6', desc:"Feature 2-3 customer stories or reviews with photos. Real names and real results. Let customers sell for you. This builds the trust needed for purchase." },
    { emoji:'üéÅ', title:'Email 5 ‚Äî First Purchase Incentive', timing:'Day 8', desc:"Offer a time-limited reason to buy now. 10% off, free shipping, or bonus gift. Create urgency. This is your conversion email ‚Äî make the CTA unmissable." },
  ],
  cart: [
    { emoji:'‚è∞', title:'Email 1 ‚Äî Cart Reminder', timing:'1 hour after abandonment', desc:"Short and casual. You left something. Show the exact product they added with image, name, and price. Single CTA button: Return to Cart. No discounts yet." },
    { emoji:'ü§î', title:'Email 2 ‚Äî Address Objections', timing:'24 hours later', desc:"Anticipate why they didn't buy. Price concern? Show value. Shipping worry? Highlight your policy. Not sure? Add reviews. Offer reassurance, not desperation." },
    { emoji:"üîî", title:'Email 3 ‚Äî Final Nudge', timing:'48 hours later', desc:"Last email in this sequence. Create urgency: low stock, offer expiring, or a small incentive. Keep it short. Two lines max then CTA. Don't over-explain." },
  ],
  postpurchase: [
    { emoji:"üéâ", title:'Email 1 ‚Äî Order Confirmation', timing:'Immediately', desc:"Confirm order details. Build excitement ‚Äî they made a great choice. Include order summary, expected delivery timeline, and customer service contact." },
    { emoji:'üìñ', title:'Email 2 ‚Äî How to Use / What to Expect', timing:'Day 3', desc:"Help them get value immediately. Usage tips, setup guide, or what to expect when the package arrives. Reduces refund requests and increases satisfaction." },
    { emoji:'‚≠ê', title:'Email 3 ‚Äî Review Request', timing:'Day 14 (after delivery)', desc:"Ask for an honest review. Make it easy with a direct link. Explain why it helps (it helps other customers find you). One simple CTA. No discount needed here." },
    { emoji:'üîÑ', title:'Email 4 ‚Äî Cross-Sell', timing:'Day 21', desc:"Suggest complementary products based on what they bought. Customers who bought X also love Y. Keep product recommendations relevant. Soft sell only." },
  ],
  winback: [
    { emoji:'üíå', title:'Email 1 ‚Äî We Miss You', timing:'60 days since last purchase', desc:"Warm, not pushy. Acknowledge the time passed. Show what's new. 2-3 new arrivals or highlights. Remind them why they liked the brand in the first place." },
    { emoji:"üéÅ", title:'Email 2 ‚Äî Returning Customer Offer', timing:'Day 67', desc:"Give them a reason to come back. Exclusive returning customer discount or free shipping. Frame it as a welcome back not a desperate sale." },
    { emoji:'üëã', title:'Email 3 ‚Äî Last Chance', timing:'Day 74', desc:"Honest subject line. Tell them this is the last email unless they want to hear from you. Give them an option to stay subscribed or opt-out gracefully. Honesty wins." },
  ],
  full: [
    { emoji:'üèóÔ∏è', title:'Phase 1 ‚Äî Account & Integration Setup', timing:'Day 1', desc:"Create Klaviyo account. Connect Shopify store. Install Klaviyo embed code. Configure basic account settings, timezone, and sender info." },
    { emoji:'üìù', title:'Phase 2 ‚Äî List Setup & Segmentation', timing:'Day 1-2', desc:"Create core lists: Master List, Customers, Non-Customers, VIP. Set up basic segments: New subscribers, Active buyers, At-risk, Win-back candidates." },
    { emoji:'üëã', title:'Phase 3 ‚Äî Welcome Flow', timing:'Week 1', desc:"Build 5-email welcome series. Set triggers, delays, and filters. Write copy and design templates. Test before activating." },
    { emoji:'üõí', title:'Phase 4 ‚Äî Cart & Browse Flows', timing:'Week 1-2', desc:"Set up abandoned cart (3 emails) and browse abandonment (3 emails). Configure triggers to fire correctly. Add product blocks and dynamic content." },
    { emoji:'üì¶', title:'Phase 5 ‚Äî Post-Purchase Flow', timing:'Week 2', desc:"Build post-purchase sequence. Set up review request automation. Configure cross-sell recommendations. Link to loyalty program if applicable." },
    { emoji:'üíî', title:'Phase 6 ‚Äî Win-Back & Sunset', timing:'Week 2-3', desc:"Create win-back campaign for 60-90 day inactive customers. Set up sunset flow to clean list of permanently unengaged subscribers." },
    { emoji:'üìä', title:'Phase 7 ‚Äî Reporting & Optimization', timing:'Ongoing', desc:"Set up revenue attribution dashboard. Monitor open rates, CTRs, and revenue per recipient. A/B test subject lines monthly. Review and optimize quarterly." },
  ],
};

function renderSeq() {
  const type = document.getElementById('seqType').value;
  const seq = SEQUENCES[type] || [];
  document.getElementById('seqTimeline').innerHTML = seq.map(s => `
    <div class="seq-item">
      <div class="seq-dot">${s.emoji}</div>
      <div class="seq-body">
        <div class="seq-title">${s.title}</div>
        <div class="seq-timing">${s.timing}</div>
        <div class="seq-desc">${s.desc}</div>
      </div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  KLAVIYO ‚Äî CHECKLIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CHECKLIST_ITEMS = [
  { text:'Create Klaviyo account and verify sender email domain', tag:'Account Setup' },
  { text:'Connect Shopify store to Klaviyo via native integration', tag:'Integration' },
  { text:'Install Klaviyo JavaScript snippet in Shopify theme', tag:'Integration' },
  { text:'Configure account timezone, currency, and brand colors', tag:'Account Setup' },
  { text:'Set up email sender profile (from name, reply-to, address)', tag:'Account Setup' },
  { text:'Create master email list and import existing customer emails', tag:'Lists' },
  { text:'Set up core segments: Active, New, At-Risk, Win-Back candidates', tag:'Segmentation' },
  { text:'Design and save reusable email template with client branding', tag:'Design' },
  { text:'Build and activate Welcome Series (5 emails)', tag:'Flows' },
  { text:'Build and activate Abandoned Cart Flow (3 emails)', tag:'Flows' },
  { text:'Build and activate Browse Abandonment Flow (2-3 emails)', tag:'Flows' },
  { text:'Build and activate Post-Purchase Flow (4 emails)', tag:'Flows' },
  { text:'Build and activate Win-Back Flow (3 emails)', tag:'Flows' },
  { text:'Set up SMS opt-in if client wants SMS marketing', tag:'SMS' },
  { text:'Configure revenue attribution and flow analytics', tag:'Reporting' },
  { text:'Test all flows with test email before going live', tag:'QA' },
  { text:'Set up A/B test on first Welcome email subject line', tag:'Optimization' },
  { text:'Schedule first campaign email for the week of launch', tag:'Campaigns' },
  { text:'Document all flow settings and hand over to client', tag:'Handoff' },
];

let checkStates = {};

function renderChecklist() {
  document.getElementById('checklistEl').innerHTML = CHECKLIST_ITEMS.map((item, i) => `
    <div class="check-item ${checkStates[i]?'done':''}" onclick="toggleCheck(${i}, this)">
      <div class="check-box"></div>
      <div>
        <div class="check-text">${item.text}</div>
        <div class="check-tag">${item.tag}</div>
      </div>
    </div>`).join('');
}

function toggleCheck(i, el) {
  checkStates[i] = !checkStates[i];
  el.classList.toggle('done', checkStates[i]);
  const done = Object.values(checkStates).filter(Boolean).length;
  toast(`${done}/${CHECKLIST_ITEMS.length} tasks complete`);
}

function klavTab(tab, el) {
  document.querySelectorAll('.ktab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.klav-tab-content').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('ktab-'+tab).classList.add('active');
  if (tab==='flows') renderFlows();
  if (tab==='planner') renderSeq();
  if (tab==='checklist') renderChecklist();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  OUTREACH TOGGLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setOutreach(id, type, el) {
  const lead = leads.find(l => l.id === id);
  if (!lead) return;
  lead.outreachType = type;
  const toggle = document.getElementById('otoggle-' + id);
  if (toggle) {
    toggle.querySelectorAll('.ot-opt').forEach(o => o.classList.remove('ot-active','ot-dm-active','ot-wa-active'));
    if (type === 'dm') el.classList.add('ot-dm-active');
    else if (type === 'wa') el.classList.add('ot-wa-active');
    else el.classList.add('ot-active');
  }
  const btn = document.getElementById('reachbtn-' + id);
  if (btn) {
    if (type === 'dm') btn.textContent = 'üì∏ DM Script';
    else if (type === 'wa') btn.textContent = 'üí¨ WA Script';
    else btn.textContent = '‚úâÔ∏è Email Script';
  }
}

function handleOutreach(id) {
  const lead = leads.find(l => l.id === id);
  if (!lead) return;
  if (lead.outreachType === 'dm' && lead.handle) openDM(id);
  else if (lead.outreachType === 'wa' && lead.whatsapp) openWA(id);
  else openEmail(id);
}

// WhatsApp ‚Äî warm, personal, reads like a voice note transcript
// Structure: Personal greeting ‚Üí Specific what you saw ‚Üí Why it matters to THEIR business ‚Üí Simple CTA
// Different from email (no formal proof section) and DM (longer, warmer, more personal)
function generateWA(lead) {
  const f = firstName(lead.name);
  const niche = (lead.niche || 'e-commerce').toLowerCase().split(' & ')[0];
  const pains = lead.painPoints || [];
  const pain1 = pains[0] ? pains[0].toLowerCase().slice(0, 90) : '';
  const pain2 = pains[1] ? pains[1].toLowerCase().slice(0, 80) : '';
  const pick = arr => arr[Math.floor(Math.random() * arr.length)];
  const avgP = lead.avgPrice ? '$' + parseFloat(lead.avgPrice).toFixed(0) : '';
  const day = pick(['Monday','Tuesday','Wednesday','Thursday','Friday']);

  // WA is MORE personal than email, LONGER than IG DM
  // Reads like someone talking ‚Äî not pitching. Warm tone.
  // References specific store data to feel researched not mass-sent

  const greeting = pick([
    `Hi ${f}! Hope you're well.`,
    `Hey ${f}, hope this finds you well!`,
    `Hi ${f}! Reaching out because I came across ${lead.name} and genuinely couldn't scroll past without saying something.`,
  ]);

  const discovery = pick([
    `I came across ${lead.name} today while going through ${niche} Shopify stores${avgP ? " ‚Äî loved the " + avgP + " price point positioning" : ''}.`,
    `Found ${lead.name} earlier and spent a bit of time on the store. Genuinely like what you're building${avgP ? ' at the ' + avgP + ' price range' : ''} ‚Äî real brand energy.`,
  ]);

  // Pain points framed as business impact, not criticism
  let painSection = '';
  if (pain1 && pain2) {
    painSection = `I did notice two things that are probably costing the store revenue though:

1. ${pain1}
2. ${pain2}

Neither is a big rebuild ‚Äî they're the kind of fixes that compound over time and show up in your numbers.`;
  } else if (pain1) {
    painSection = `One thing I noticed that's probably costing the store some revenue ‚Äî ${pain1}. It's very fixable and the kind of change that shows up in your conversion numbers pretty quickly.`;
  } else {
    painSection = `I noticed a couple of things on the store that I think are leaving revenue on the table. Nothing major to rebuild ‚Äî more like the kind of focused fixes that move your conversion numbers.`;
  }

  const credAndCTA = pick([
    `I'm Victor ‚Äî I do UI/UX and Shopify development specifically for ${niche} brands. I've helped stores at a similar stage make this kind of improvement and it's always been worth it for them.

Would you be open to a quick 15-minute call this week ‚Äî maybe ${day}? I'd love to share the specific ideas I have for ${lead.name}.`,
    `My name is Victor, I'm a UI/UX designer and Shopify dev ‚Äî I work specifically with ${niche} stores on this kind of thing. Recently helped a similar brand with exactly these issues.

Worth a quick call to walk you through what I'd do for ${lead.name}? Could do ${day} if that works for you.`,
  ]);

  return `${greeting}

${discovery}

${painSection}

${credAndCTA}

‚Äî Victor
TeeJay Max Studio | @vics.ui`;
}

function openWA(id) {
  activeLead = leads.find(l => l.id === id);
  if (!activeLead) return;
  if (!activeLead.analyzed) {
    activeLead.painPoints = getPains(activeLead);
    activeLead.analyzed = true;
  }
  populateWA();
  document.getElementById('waOverlay').classList.add('open');
}

function populateWA() {
  const l = activeLead;
  document.getElementById('waName').textContent = l.name;
  const painBox = document.getElementById('waPainBox');
  if (l.painPoints.length) {
    painBox.style.display = 'block';
    document.getElementById('waPainText').textContent = l.painPoints[0];
  } else {
    painBox.style.display = 'none';
  }
  const waLink = document.getElementById('waOpenLink');
  waLink.href = l.whatsapp || '#';
  document.getElementById('waBody').value = generateWA(l);
}

function regenWA() { populateWA(); toast('üîÑ New WA script generated'); }

function copyWA() {
  const body = document.getElementById('waBody').value;
  robustCopy(body, 'üìã WhatsApp message copied ‚Äî open the chat and paste!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INSTAGRAM DM GENERATOR (Abiola Framework ‚Äî DM Edition)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generateDM(lead) {
  const f = firstName(lead.name);
  const store = lead.store ? lead.store.split('.')[0] : lead.name.split(' ')[0];
  const niche = (lead.niche || 'e-commerce').toLowerCase().split(' & ')[0];
  const pain = lead.painPoints[0] || '';
  const pick = arr => arr[Math.floor(Math.random() * arr.length)];

  // Abiola DM style: ultra short, specific, human, one question CTA
  // Line 1: Specific observation (they feel seen)
  // Line 2: One pain point or opportunity (brief)
  // Line 3: Credibility in one line
  // Line 4: Single soft question CTA

  const openers = [
    `Hey ${f}, came across ${lead.name} and genuinely love what you're building ‚Äî the brand has a real identity.`,
    `Hi ${f}! Found ${lead.name} while going through ${niche} brands ‚Äî really clean direction, you've clearly put thought into it.`,
    `Hey ${f} ‚Äî just discovered ${lead.name} and had to reach out. Great ${niche} brand energy.`,
  ];

  const bridges = pain ? [
    `One thing I noticed though ‚Äî ${pain.toLowerCase().slice(0,80)}. Quietly costs sales for a lot of ${niche} stores.`,
    `Quick thing I spotted ‚Äî ${pain.toLowerCase().slice(0,80)}. Easy fix that could move the needle on conversions.`,
    `Something caught my eye though ‚Äî ${pain.toLowerCase().slice(0,80)}. Worth a look if you want to improve the store's results.`,
  ] : [
    `I work with ${niche} Shopify brands on design and conversion ‚Äî and I think your store has some quick wins worth exploring.`,
    `I specialize in ${niche} store design and I spotted a couple of things on your site that could improve conversions noticeably.`,
  ];

  const creds = [
    `I'm a UI/UX designer + Shopify dev ‚Äî I've helped ${niche} brands fix these kinds of issues and seen real results within weeks.`,
    `I do UI/UX and Shopify dev for ${niche} brands ‚Äî recently helped a similar store improve their checkout rate significantly.`,
    `UI/UX designer here, I work specifically with ${niche} Shopify stores on this kind of thing.`,
  ];

  const ctas = [
    `Would you be open to a quick 10-min chat about it?`,
    `Worth a quick call to walk you through what I'd do?`,
    `Happy to share the specific ideas ‚Äî would that be useful?`,
    `Is that something you'd want to explore?`,
  ];

  return `${pick(openers)}

${pick(bridges)}

${pick(creds)}

${pick(ctas)}`;
}

function openDM(id) {
  activeLead = leads.find(l => l.id === id);
  if (!activeLead) return;
  if (!activeLead.analyzed) {
    activeLead.painPoints = getPains(activeLead);
    activeLead.analyzed = true;
  }
  populateDM();
  document.getElementById('dmOverlay').classList.add('open');
}

function populateDM() {
  const l = activeLead;
  document.getElementById('dmName').textContent = l.name;

  // Pain point display
  const painBox = document.getElementById('dmPainBox');
  if (l.painPoints.length) {
    painBox.style.display = 'block';
    document.getElementById('dmPainText').textContent = l.painPoints[0];
  } else {
    painBox.style.display = 'none';
  }

  // IG profile link
  const igLink = document.getElementById('dmOpenLink');
  if (l.handle) {
    igLink.href = 'https://instagram.com/' + l.handle.replace('@','');
    igLink.style.display = 'flex';
  } else {
    igLink.style.display = 'none';
  }

  document.getElementById('dmBody').value = generateDM(l);
}

function regenDM() { populateDM(); toast('üîÑ New DM variation generated'); }

function copyDM() {
  const body = document.getElementById('dmBody').value;
  robustCopy(body, 'üìã DM copied ‚Äî paste it on Instagram!');
}

// ‚îÄ‚îÄ MOBILE MENU ‚îÄ‚îÄ
function toggleMobMenu() {
  document.getElementById('mainSidebar').classList.toggle('mob-open');
  document.getElementById('sidebarOverlay').classList.toggle('mob-open');
}
function closeMobMenu() {
  document.getElementById('mainSidebar').classList.remove('mob-open');
  document.getElementById('sidebarOverlay').classList.remove('mob-open');
}
// Close sidebar when nav item clicked on mobile
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    if (window.innerWidth <= 768) closeMobMenu();
  });
});

// Init
renderProducts();
renderFlows();
renderSeq();
renderChecklist();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CJ API INTEGRATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let cjApiKey = '';
let cjAccessToken = '';
let cjProxyUrl = '';
let cjConnected = false;

function toggleKey() {
  const input = document.getElementById('cjApiKey');
  const btn = document.getElementById('toggleKeyVis');
  if (input.type === 'password') { input.type = 'text'; btn.textContent = 'üôà Hide'; }
  else { input.type = 'password'; btn.textContent = 'üëÅ Show'; }
}

async function connectCJ() {
  const email = (document.getElementById('cjEmail') ? document.getElementById('cjEmail').value.trim() : '');
  const key   = document.getElementById('cjApiKey').value.trim();
  const proxy = document.getElementById('proxyUrl').value.trim();

  if (!email) { toast('‚ö† Enter your CJ account email first'); document.getElementById('cjEmail').focus(); return; }
  if (!email.includes("@")) { toast("‚ö† That doesn't look like a valid email"); return; }
  if (!key)   { toast('‚ö† Paste your CJ API key first'); return; }
  if (!proxy) { toast('‚ö† Paste your Vercel proxy URL first'); return; }

  const status = document.getElementById('cjStatus');
  status.className = 'api-status testing';
  status.textContent = '‚è≥ Testing connection via proxy...';
  document.getElementById('ep-auth').textContent = 'testing';
  document.getElementById('ep-auth').className = 'endpoint-status idle';

  try {
    const proxyBase = proxy.replace(/\/$/, '');

    // CJ auth endpoint ‚Äî email + API key as password
    const response = await fetch(proxyBase + '?endpoint=authentication/getAccessToken', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email, password: key })
    });

    if (!response.ok) throw new Error('Proxy returned HTTP ' + response.status + ' ‚Äî check your proxy URL');

    const data = await response.json();

    if (data.code === 200 && data.data && data.data.accessToken) {
      cjApiKey = key;
      cjAccessToken = data.data.accessToken;
      cjProxyUrl = proxyBase;
      cjConnected = true;

      status.className = 'api-status connected';
      status.textContent = '‚úì Connected ‚Äî live CJ product data is now active';

      ['ep-auth','ep-product','ep-variant','ep-stock','ep-sourcing'].forEach(id => {
        document.getElementById(id).textContent = 'active';
        document.getElementById(id).className = 'endpoint-status active';
      });

      toast('üéâ CJ connected! Go to Product Research to search live products');
      enableLiveProductSearch();

    } else {
      // Show the exact error CJ returns so we can diagnose it
      const msg = data.message || data.msg || JSON.stringify(data).slice(0, 100);
      throw new Error(msg);
    }
  } catch (err) {
    status.className = 'api-status disconnected';
    status.textContent = '‚úï Connection failed ‚Äî ' + err.message;
    toast('‚ö† ' + err.message);
    console.error('CJ API error:', err);
  }
}

function showCorsWorkaround() {
  const existing = document.getElementById('corsNote');
  if (existing) return;
  const card = document.createElement('div');
  card.id = 'corsNote';
  card.className = 'settings-card';
  card.style.marginTop = '16px';

  const title = document.createElement('div');
  title.className = 'settings-card-title';
  title.style.color = 'var(--amber)';
  title.textContent = '‚ö° Quick Workaround ‚Äî Paste Access Token Directly';

  const sub = document.createElement('div');
  sub.className = 'settings-card-sub';
  sub.innerHTML = 'CJ blocks direct browser calls for security (CORS). Fastest fix:<br><br>'
    + '1. Go to <strong>Hoppscotch.io</strong> (free browser API tool)<br>'
    + '2. Make a POST request to the CJ auth endpoint with your email + API secret<br>'
    + '3. Copy the <code style="background:var(--surface2);padding:2px 6px;border-radius:4px;color:var(--accent2)">accessToken</code> from the JSON response<br>'
    + '4. Paste it below and click Activate';

  const label = document.createElement('div');
  label.style.cssText = 'font-size:11px;color:var(--muted2);margin-bottom:6px;margin-top:12px';
  label.textContent = 'Paste CJ Access Token directly';

  const row = document.createElement('div');
  row.className = 'api-input-wrap';

  const inp = document.createElement('input');
  inp.type = 'password';
  inp.id = 'cjTokenDirect';
  inp.placeholder = 'Paste accessToken from CJ API response...';
  inp.autocomplete = 'off';

  const btn = document.createElement('button');
  btn.className = 'btn btn-green';
  btn.textContent = 'Activate';
  btn.onclick = activateToken;

  row.appendChild(inp);
  row.appendChild(btn);
  card.appendChild(title);
  card.appendChild(sub);
  card.appendChild(label);
  card.appendChild(row);

  const page = document.getElementById('page-settings');
  page.insertBefore(card, page.children[2]);
}

function activateToken() {
  const token = document.getElementById('cjTokenDirect').value.trim();
  if (!token) { toast('‚ö† Paste your access token first'); return; }
  cjAccessToken = token;
  cjConnected = true;
  const status = document.getElementById('cjStatus');
  status.className = 'api-status connected';
  status.textContent = '‚úì Access token activated ‚Äî live product data enabled';
  ['ep-auth','ep-product','ep-variant','ep-stock','ep-sourcing'].forEach(id => {
    document.getElementById(id).textContent = 'active';
    document.getElementById(id).className = 'endpoint-status active';
  });
  toast('üéâ CJ connected via access token! Go to Product Research');
  enableLiveProductSearch();
}

function enableLiveProductSearch() {
  // Replace static product section header with live search
  const apiNote = document.querySelector('.api-note');
  if (apiNote) {
    apiNote.style.background = 'var(--green-dim)';
    apiNote.style.borderColor = '#4afaa020';
    apiNote.style.color = 'var(--green)';
    apiNote.innerHTML = '‚úì CJ API connected ‚Äî showing live product data. Use the search below to find any product.';
  }

  // Add live search bar to products page
  const secHead = document.querySelector('#page-products .sec-head');
  if (secHead && !document.getElementById('liveSearchBar')) {
    const searchBar = document.createElement('div');
    searchBar.id = 'liveSearchBar';
    searchBar.style.cssText = 'display:flex;gap:10px;margin-bottom:16px';
    searchBar.innerHTML = `
      <input type="text" id="cjSearchInput" placeholder="Search CJ catalog: skincare, jewelry, fitness gear..." style="flex:1">
      <button class="btn btn-accent" onclick="searchCJProducts()">üîç Search CJ Live</button>`;
    secHead.parentNode.insertBefore(searchBar, secHead.nextSibling);
  }
}

async function searchCJProducts() {
  if (!cjConnected || !cjAccessToken) {
    toast('‚ö† Connect your CJ API first in Settings');
    goTo('settings', document.querySelector('[onclick*=settings]'));
    return;
  }

  const query = document.getElementById('cjSearchInput').value.trim();
  if (!query) { toast('‚ö† Enter a product to search'); return; }

  const grid = document.getElementById('productsGrid');
  grid.innerHTML = '<div style="text-align:center;padding:60px;color:var(--muted2)"><div class="spin" style="width:24px;height:24px;margin:0 auto 12px"></div><div>Searching CJ catalog for "' + query + '"...</div></div>';

  try {
    const query = document.getElementById('cjSearchInput').value.trim();
    const response = await fetch(
      `${cjProxyUrl}?endpoint=product/query&productName=${encodeURIComponent(query)}&pageNum=1&pageSize=20`,
      {
        method: 'GET',
        headers: {
          'CJ-Access-Token': cjAccessToken,
          'Content-Type': 'application/json'
        }
      }
    );

    const data = await response.json();

    if (data.code === 200 && data.data && data.data.list) {
      renderCJProducts(data.data.list);
      toast('‚úÖ Found ' + data.data.list.length + ' live products from CJ');
    } else {
      throw new Error(data.message || 'Search failed');
    }
  } catch (err) {
    toast('‚ö† Search failed: ' + err.message);
    grid.innerHTML = '<div style="text-align:center;padding:60px;color:var(--muted2)"><div style="font-size:14px">Search failed ‚Äî make sure your proxy is deployed and connected in Settings.</div></div>';
  }
}

function renderCJProducts(products) {
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = products.slice(0, 20).map(p => {
    const cost = parseFloat(p.sellPrice || p.variants?.[0]?.variantSellPrice || 0);
    const sell = (cost * 3).toFixed(2);
    const profit = (sell - cost).toFixed(2);
    const margin = Math.round(((sell - cost) / sell) * 100);
    const img = p.productImage || p.productImageSet?.[0] || '';
    return `
    <div class="prod-card">
      <div class="prod-img">
        ${img ? `<img src="${img}" alt="${p.productNameEn}" onerror="this.style.display='none'">` : '<span style="font-size:48px">üì¶</span>'}
        <div class="trend-badge stable">‚úÖ LIVE</div>
      </div>
      <div class="prod-body">
        <div class="prod-name">${(p.productNameEn || p.productName || 'CJ Product').slice(0, 60)}</div>
        <div class="prod-niche" style="font-family:'DM Mono',monospace">${p.categoryName || 'CJ Catalog'}</div>
        <div class="price-row">
          <div class="price-block"><div class="price-label">CJ Cost</div><div class="price-val cost">$${cost.toFixed(2)}</div></div>
          <div class="price-divider"></div>
          <div class="price-block"><div class="price-label">Sell At</div><div class="price-val sell">$${sell}</div></div>
          <div class="price-divider"></div>
          <div class="price-block"><div class="price-label">Profit</div><div class="price-val profit">$${profit}</div></div>
        </div>
        <div class="markup-bar-wrap">
          <div class="markup-bar-label"><span>Markup: 200%</span><span>Margin: ${margin}%</span></div>
          <div class="markup-bar"><div class="markup-fill" style="width:${Math.min(margin,100)}%"></div></div>
        </div>
        <div class="prod-stats">
          <div class="pstat"><div class="pstat-val" style="color:var(--green)">‚úì Live</div><div class="pstat-label">CJ Stock</div></div>
          <div class="pstat"><div class="pstat-val">${p.packWeight || '‚Äî'}g</div><div class="pstat-label">Weight</div></div>
          <div class="pstat"><div class="pstat-val">${p.variants?.length || 1}</div><div class="pstat-label">Variants</div></div>
        </div>
        <button class="btn btn-accent btn-sm" style="width:100%;margin-top:4px" onclick="toast('Product added to store list')">+ Add to Store List</button>
      </div>
    </div>`;
  }).join('');
}
</script>
</body>
</html>
